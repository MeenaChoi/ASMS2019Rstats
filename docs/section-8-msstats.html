<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Section 8 : MSstats | ASMS 2019: Case studies in quantitative proteomics</title>
  <meta name="description" content="Chapter 2 Section 8 : MSstats | ASMS 2019: Case studies in quantitative proteomics" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Section 8 : MSstats | ASMS 2019: Case studies in quantitative proteomics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Section 8 : MSstats | ASMS 2019: Case studies in quantitative proteomics" />
  
  
  

<meta name="author" content="Meena Choi and Ting Huang" />


<meta name="date" content="2019-06-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-6-introductory-statistics-with-r.html">
<link rel="next" href="section-9-msstatstmt.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Before we start</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html"><i class="fa fa-check"></i><b>1</b> Section 6: Introductory statistics with R</a><ul>
<li class="chapter" data-level="1.1" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#basic-statistics"><i class="fa fa-check"></i><b>1.1</b> Basic statistics</a><ul>
<li class="chapter" data-level="1.1.1" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#randomization"><i class="fa fa-check"></i><b>1.1.1</b> Randomization</a></li>
<li class="chapter" data-level="1.1.2" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#basic-statistical-summaries"><i class="fa fa-check"></i><b>1.1.2</b> Basic statistical summaries</a></li>
<li class="chapter" data-level="1.1.3" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#visualization-with-error-bars-for-descriptive-purpose"><i class="fa fa-check"></i><b>1.1.3</b> Visualization with error bars for descriptive purpose</a></li>
<li class="chapter" data-level="1.1.4" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#working-with-statistical-distributions"><i class="fa fa-check"></i><b>1.1.4</b> Working with statistical distributions</a></li>
<li class="chapter" data-level="1.1.5" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#calculate-the-confidence-interval"><i class="fa fa-check"></i><b>1.1.5</b> Calculate the confidence interval</a></li>
<li class="chapter" data-level="1.1.6" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#saving-our-results"><i class="fa fa-check"></i><b>1.1.6</b> Saving our results</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#statistical-hypothesis-test"><i class="fa fa-check"></i><b>1.2</b> Statistical hypothesis test</a><ul>
<li class="chapter" data-level="1.2.1" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#two-sample-t-test-for-one-protein-with-one-feature"><i class="fa fa-check"></i><b>1.2.1</b> Two sample t-test for one protein with one feature</a></li>
<li class="chapter" data-level="1.2.2" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#the-htest-class"><i class="fa fa-check"></i><b>1.2.2</b> The <code>htest</code> class</a></li>
<li class="chapter" data-level="1.2.3" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#re-calculating-the-p-values"><i class="fa fa-check"></i><b>1.2.3</b> Re-calculating the p values</a></li>
<li class="chapter" data-level="1.2.4" data-path="section-6-introductory-statistics-with-r.html"><a href="section-6-introductory-statistics-with-r.html#choosing-a-model"><i class="fa fa-check"></i><b>1.2.4</b> Choosing a model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-8-msstats.html"><a href="section-8-msstats.html"><i class="fa fa-check"></i><b>2</b> Section 8 : MSstats</a><ul>
<li class="chapter" data-level="2.1" data-path="section-8-msstats.html"><a href="section-8-msstats.html#introduction-to-data-and-preprocessing"><i class="fa fa-check"></i><b>2.1</b> introduction to data and preprocessing</a><ul>
<li class="chapter" data-level="2.1.1" data-path="section-8-msstats.html"><a href="section-8-msstats.html#objective"><i class="fa fa-check"></i><b>2.1.1</b> Objective</a></li>
<li class="chapter" data-level="2.1.2" data-path="section-8-msstats.html"><a href="section-8-msstats.html#workflow-in-msstats"><i class="fa fa-check"></i><b>2.1.2</b> Workflow in MSstats</a></li>
<li class="chapter" data-level="2.1.3" data-path="section-8-msstats.html"><a href="section-8-msstats.html#data"><i class="fa fa-check"></i><b>2.1.3</b> Data</a></li>
<li class="chapter" data-level="2.1.4" data-path="section-8-msstats.html"><a href="section-8-msstats.html#load-msstats"><i class="fa fa-check"></i><b>2.1.4</b> Load MSstats</a></li>
<li class="chapter" data-level="2.1.5" data-path="section-8-msstats.html"><a href="section-8-msstats.html#allowable-data-formats"><i class="fa fa-check"></i><b>2.1.5</b> Allowable data formats</a></li>
<li class="chapter" data-level="2.1.6" data-path="section-8-msstats.html"><a href="section-8-msstats.html#convert-to-msstats-required-format-data-cleaning"><i class="fa fa-check"></i><b>2.1.6</b> Convert to MSstats required format (Data cleaning)</a></li>
<li class="chapter" data-level="2.1.7" data-path="section-8-msstats.html"><a href="section-8-msstats.html#save-your-work"><i class="fa fa-check"></i><b>2.1.7</b> Save your work</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="section-8-msstats.html"><a href="section-8-msstats.html#data-processing---normalization-and-run-summarization"><i class="fa fa-check"></i><b>2.2</b> Data processing - Normalization and run summarization</a><ul>
<li class="chapter" data-level="2.2.1" data-path="section-8-msstats.html"><a href="section-8-msstats.html#dataprocess-with-skyline-data"><i class="fa fa-check"></i><b>2.2.1</b> dataProcess with Skyline data</a></li>
<li class="chapter" data-level="2.2.2" data-path="section-8-msstats.html"><a href="section-8-msstats.html#dataprocess-with-maxquant-data"><i class="fa fa-check"></i><b>2.2.2</b> dataProcess with MaxQuant data</a></li>
<li class="chapter" data-level="2.2.3" data-path="section-8-msstats.html"><a href="section-8-msstats.html#dataprocess-with-openms-data"><i class="fa fa-check"></i><b>2.2.3</b> dataProcess with OpenMS data</a></li>
<li class="chapter" data-level="2.2.4" data-path="section-8-msstats.html"><a href="section-8-msstats.html#dataprocess-with-progenesis-data"><i class="fa fa-check"></i><b>2.2.4</b> dataProcess with Progenesis data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="section-8-msstats.html"><a href="section-8-msstats.html#differential-abundance-and-sample-size-calculation"><i class="fa fa-check"></i><b>2.3</b> Differential abundance and sample size calculation</a><ul>
<li class="chapter" data-level="2.3.1" data-path="section-8-msstats.html"><a href="section-8-msstats.html#inference-and-future-design-of-experiment-with-skyline-output"><i class="fa fa-check"></i><b>2.3.1</b> Inference and future design of experiment with Skyline output</a></li>
<li class="chapter" data-level="2.3.2" data-path="section-8-msstats.html"><a href="section-8-msstats.html#inference-and-future-design-of-experiment-with-skyline-output-1"><i class="fa fa-check"></i><b>2.3.2</b> Inference and future design of experiment with Skyline output</a></li>
<li class="chapter" data-level="2.3.3" data-path="section-8-msstats.html"><a href="section-8-msstats.html#inference-and-future-design-of-experiment-with-openms-output"><i class="fa fa-check"></i><b>2.3.3</b> Inference and future design of experiment with OpenMS output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html"><i class="fa fa-check"></i><b>3</b> Section 9: MSstatsTMT</a><ul>
<li class="chapter" data-level="3.1" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#introductioin-to-data-and-preprocessing"><i class="fa fa-check"></i><b>3.1</b> Introductioin to data and preprocessing</a><ul>
<li class="chapter" data-level="3.1.1" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#objective-1"><i class="fa fa-check"></i><b>3.1.1</b> Objective</a></li>
<li class="chapter" data-level="3.1.2" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#data-1"><i class="fa fa-check"></i><b>3.1.2</b> Data</a></li>
<li class="chapter" data-level="3.1.3" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#load-msstatstmt"><i class="fa fa-check"></i><b>3.1.3</b> Load MSstatsTMT</a></li>
<li class="chapter" data-level="3.1.4" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#allowable-data-formats-1"><i class="fa fa-check"></i><b>3.1.4</b> Allowable data formats</a></li>
<li class="chapter" data-level="3.1.5" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#proteome-discoverer-output"><i class="fa fa-check"></i><b>3.1.5</b> Proteome Discoverer output</a></li>
<li class="chapter" data-level="3.1.6" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#maxquant-output-1"><i class="fa fa-check"></i><b>3.1.6</b> MaxQuant output</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#summarization-normalization-and-significance-analysis"><i class="fa fa-check"></i><b>3.2</b> Summarization, normalization and significance analysis</a><ul>
<li class="chapter" data-level="3.2.1" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#objective-2"><i class="fa fa-check"></i><b>3.2.1</b> Objective</a></li>
<li class="chapter" data-level="3.2.2" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#data-2"><i class="fa fa-check"></i><b>3.2.2</b> Data</a></li>
<li class="chapter" data-level="3.2.3" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#process-with-processed-pd-data"><i class="fa fa-check"></i><b>3.2.3</b> Process with processed PD data</a></li>
<li class="chapter" data-level="3.2.4" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#normalizing-and-summarizing-data-with-proteinsummarization"><i class="fa fa-check"></i><b>3.2.4</b> Normalizing and summarizing data with proteinSummarization</a></li>
<li class="chapter" data-level="3.2.5" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#visualization-of-processed-data-1"><i class="fa fa-check"></i><b>3.2.5</b> Visualization of processed data</a></li>
<li class="chapter" data-level="3.2.6" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#different-parameter-options-for-summarization-and-normalization"><i class="fa fa-check"></i><b>3.2.6</b> Different parameter options for summarization and normalization</a></li>
<li class="chapter" data-level="3.2.7" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#finding-differentially-abundant-proteins-across-conditions-1"><i class="fa fa-check"></i><b>3.2.7</b> Finding differentially abundant proteins across conditions</a></li>
<li class="chapter" data-level="3.2.8" data-path="section-9-msstatstmt.html"><a href="section-9-msstatstmt.html#msstatstmt.log-and-sessioninfo.txt"><i class="fa fa-check"></i><b>3.2.8</b> msstatstmt.log and sessionInfo.txt</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ASMS 2019: Case studies in quantitative proteomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-8-msstats" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Section 8 : MSstats</h1>
<div id="introduction-to-data-and-preprocessing" class="section level2">
<h2><span class="header-section-number">2.1</span> introduction to data and preprocessing</h2>
<div id="objective" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Objective</h3>
<ul>
<li>Preprocessing steps to make required input format for MSstats from output from diverse output of spectral processing tools.</li>
<li>Make annotation file, based on experimental design.</li>
</ul>
<hr />
</div>
<div id="workflow-in-msstats" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Workflow in MSstats</h3>
<p><img src="img/MSstats_intro1.png" /></p>
<p><img src="img/MSstats_intro2.png" />
<img src="img/MSstats_intro3.png" /></p>
<hr />
</div>
<div id="data" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Data</h3>
<ul>
<li>the quantified peak intensities data from ABRF 2015, processed by Skyline.</li>
</ul>
<div class="figure">
<img src="img/Protein_sample_information.png" alt="Summary of the ABRF 2015 study design, Choi, et al. J Proteome Res. 2017" style="width:70.0%" />
<p class="caption">Summary of the ABRF 2015 study design, Choi, et al. J Proteome Res. 2017</p>
</div>
<hr />
</div>
<div id="load-msstats" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Load MSstats</h3>
<p>Load MSstats first. Then you are ready to start MSstats.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MSstats)
?MSstats</code></pre>
<hr />
</div>
<div id="allowable-data-formats" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Allowable data formats</h3>
<p><code>MSstats</code> performs statistical analysis steps, that follow peak identification and quantitation. Therefore, input
to MSstats is the output of other software tools (such as <code>Skyline</code>, <code>MaxQuant</code> and so on) that read raw spectral files
, identify and quantify spectral peaks. The preferred structure of data for use in MSstats is a .csv file
in a <em>long</em> format with at least 10 columns representing the following variables: <strong>ProteinName</strong>, <strong>PeptideSequence</strong>, <strong>PrecursorCharge</strong>, <strong>FragmentIon</strong>, <strong>ProductCharge</strong>, <strong>IsotopeLabelType</strong>, <strong>Condition</strong>, <strong>BioReplicate</strong>, <strong>Run</strong>, <strong>Intensity</strong>. The variable names are fixed, but are case-insensitive.</p>
<pre><code>##   ProteinName PeptideSequence PrecursorCharge FragmentIon ProductCharge
## 1      bovine     S.PVDIDTK_5               5          NA            NA
## 2      bovine     S.PVDIDTK_5               5          NA            NA
## 3      bovine     S.PVDIDTK_5               5          NA            NA
## 4      bovine     S.PVDIDTK_5               5          NA            NA
## 5      bovine     S.PVDIDTK_5               5          NA            NA
## 6      bovine     S.PVDIDTK_5               5          NA            NA
##   IsotopeLabelType Condition BioReplicate Run Intensity
## 1                L        C1            1   1   2636792
## 2                L        C1            1   2   1992418
## 3                L        C1            1   3   1982146
## 4                L        C2            1   4   5019594
## 5                L        C2            1   5   4560468
## 6                L        C2            1   6   3627849</code></pre>
<hr />
</div>
<div id="convert-to-msstats-required-format-data-cleaning" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Convert to MSstats required format (Data cleaning)</h3>
<hr />
<p>Let’s start preprocessing steps to make required input format for MSstats from output from diverse output of spectral processing tools.</p>
<p><img src="img/MSstats_intro4.png" /></p>
<ul>
<li><p>Data input support for various data acquisition methods : DDA, DIA, SRM</p></li>
<li><p>Interoperability with existing computational tools :
- Converter functions for 7 data processin tools :
<code>SkylinetoMSstatsFormat</code>, <code>MaxQtoMSstatsFormat</code>, <code>OpenMStoMSstatsFormat</code>, <code>ProgenesistoMSstatsFormat</code>, <code>PDtoMSstatsFormat</code>, <code>SpectronauttoMSstatsFormat</code>, <code>OpenSWATHtoMSstatsFormat</code>, <code>DIAUmpiretoMSstatsFormat</code>
- Consistent data cleaning steps across converter functions : filter multiple measurements, shared peptides, etc.
- Generate the same format of data from diverse type of data format.</p></li>
</ul>
<div id="skyline-output" class="section level4">
<h4><span class="header-section-number">2.1.6.1</span> Skyline output</h4>
<div id="read-data" class="section level5">
<h5><span class="header-section-number">2.1.6.1.1</span> Read data</h5>
<p>The required input data is generated automatically when using <code>MSstats</code> report format in <code>Skyline</code>.
We first load and access the dataset processed by <code>Skyline</code>. The name of saved file from <code>Skyline</code> using <code>MSstats report format</code> is <em>‘ABRF2015_Skyline_report.csv’</em>. or you can use the published data from this link (<a href="https://panoramaweb.org/labkey/project/MacCoss/brendan/manuscripts/iPRG%202015/begin.view" class="uri">https://panoramaweb.org/labkey/project/MacCoss/brendan/manuscripts/iPRG%202015/begin.view</a>). This example dataset is the exactly same data in ‘iPRG_10ppm_2rt_15cut_nosingle.csv’ from the link above.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read output from skyline </span>
raw.skyline &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;data/data_Skyline/ABRF2015_Skyline_report.csv&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Check the first 6 rows of dataset</span>
<span class="kw">head</span>(raw.skyline)</code></pre>
<pre><code>##                   ProteinName PeptideSequence PeptideModifiedSequence
## 1 DECOY_sp|P0CF18|YM085_YEAST      KDMYGNPFQK         KDM[+16]YGNPFQK
## 2 DECOY_sp|P0CF18|YM085_YEAST      KDMYGNPFQK         KDM[+16]YGNPFQK
## 3 DECOY_sp|P0CF18|YM085_YEAST      KDMYGNPFQK         KDM[+16]YGNPFQK
## 4 DECOY_sp|P0CF18|YM085_YEAST      KDMYGNPFQK         KDM[+16]YGNPFQK
## 5 DECOY_sp|P0CF18|YM085_YEAST      KDMYGNPFQK         KDM[+16]YGNPFQK
## 6 DECOY_sp|P0CF18|YM085_YEAST      KDMYGNPFQK         KDM[+16]YGNPFQK
##   PrecursorCharge PrecursorMz FragmentIon ProductCharge ProductMz
## 1               3    415.1974   precursor             3  415.1974
## 2               3    415.1974   precursor             3  415.1974
## 3               3    415.1974   precursor             3  415.1974
## 4               3    415.1974   precursor             3  415.1974
## 5               3    415.1974   precursor             3  415.1974
## 6               3    415.1974   precursor             3  415.1974
##   IsotopeLabelType Condition BioReplicate                  FileName
## 1            light        NA           NA JD_06232014_sample1_B.raw
## 2            light        NA           NA JD_06232014_sample1_C.raw
## 3            light        NA           NA JD_06232014_sample1-A.raw
## 4            light        NA           NA JD_06232014_sample2_A.raw
## 5            light        NA           NA JD_06232014_sample2_B.raw
## 6            light        NA           NA JD_06232014_sample2_C.raw
##      Area StandardType Truncated annotation_QValue
## 1  147327           NA     False                NA
## 2 1373397           NA     False                NA
## 3   71765           NA     False                NA
## 4   66387           NA     False                NA
## 5  107736           NA     False                NA
## 6  380812           NA     False                NA</code></pre>
<p>There are some column named differently than required input. The information for <code>Condition</code> and <code>BioReplicate</code> is missing. Let’s do preliminary check for this input.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># total number of unique protein name</span>
<span class="kw">length</span>(<span class="kw">unique</span>(raw.skyline<span class="op">$</span>Protein))</code></pre>
<pre><code>## [1] 3097</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># several isotopic peaks for peptide charge</span>
<span class="kw">unique</span>(raw.skyline<span class="op">$</span>FragmentIon)</code></pre>
<pre><code>## [1] precursor       precursor [M+1] precursor [M+2]
## Levels: precursor precursor [M+1] precursor [M+2]</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># unique FileName, which is MS run.</span>
<span class="kw">unique</span>(raw.skyline<span class="op">$</span>FileName)</code></pre>
<pre><code>##  [1] JD_06232014_sample1_B.raw JD_06232014_sample1_C.raw
##  [3] JD_06232014_sample1-A.raw JD_06232014_sample2_A.raw
##  [5] JD_06232014_sample2_B.raw JD_06232014_sample2_C.raw
##  [7] JD_06232014_sample3_A.raw JD_06232014_sample3_B.raw
##  [9] JD_06232014_sample3_C.raw JD_06232014_sample4_B.raw
## [11] JD_06232014_sample4_C.raw JD_06232014_sample4-A.raw
## 12 Levels: JD_06232014_sample1_B.raw ... JD_06232014_sample4-A.raw</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># &#39;Truncated&#39; column</span>
<span class="kw">unique</span>(raw.skyline<span class="op">$</span>Truncated)</code></pre>
<pre><code>## [1] False       True 
## Levels:  False True</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># count table for &#39;Truncated&#39; column</span>
<span class="kw">xtabs</span>(<span class="op">~</span>Truncated, raw.skyline)</code></pre>
<pre><code>## Truncated
##           False    True 
##     237 1256666     829</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># count which &#39;Truncated&#39; is &#39;True&#39;</span>
<span class="kw">sum</span>(raw.skyline<span class="op">$</span>Truncated <span class="op">==</span><span class="st"> &#39;True&#39;</span>)</code></pre>
<pre><code>## [1] 829</code></pre>
</div>
<div id="set-annotation-file" class="section level5">
<h5><span class="header-section-number">2.1.6.1.2</span> Set annotation file</h5>
<p>Annotation information is required to fill in <strong>Condition</strong> and <strong>BioReplicate</strong> for corresponding <strong>Run</strong> information. Users have to prepare as csv or txt file like ‘ABRF2015_Skyline_annotation.csv’, which includes <strong>Run</strong>, <strong>Condition</strong>, and <strong>BioReplicate</strong> information, and load it in R.</p>
<pre class="sourceCode r"><code class="sourceCode r">annot.skyline &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;data/data_Skyline/ABRF2015_Skyline_annotation.csv&quot;</span>)
annot.skyline</code></pre>
<pre><code>##                          Run  Condition BioReplicate
## 1  JD_06232014_sample1-A.raw Condition1            1
## 2  JD_06232014_sample2_A.raw Condition2            2
## 3  JD_06232014_sample4_B.raw Condition4            4
## 4  JD_06232014_sample1_B.raw Condition1            1
## 5  JD_06232014_sample1_C.raw Condition1            1
## 6  JD_06232014_sample2_B.raw Condition2            2
## 7  JD_06232014_sample2_C.raw Condition2            2
## 8  JD_06232014_sample3_A.raw Condition3            3
## 9  JD_06232014_sample3_B.raw Condition3            3
## 10 JD_06232014_sample3_C.raw Condition3            3
## 11 JD_06232014_sample4-A.raw Condition4            4
## 12 JD_06232014_sample4_C.raw Condition4            4</code></pre>
<div id="common-mistake-for-annotation-file-incorrect-run-information" class="section level6">
<h6><span class="header-section-number">2.1.6.1.2.1</span> Common mistake for annotation file : Incorrect Run information</h6>
<p>Raw file name in the output of spectral processing tool is commonly long. We can make a typo in annotation file. If Raw file name and Run information are not matched,</p>
<p>Let’s check whether <strong>Run</strong> information is same as <strong>File.Name</strong> in output of <code>Skyline</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setdiff</span>(<span class="kw">unique</span>(raw.skyline<span class="op">$</span>FileName), annot.skyline<span class="op">$</span>Run)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setdiff</span>(annot.skyline<span class="op">$</span>Run, <span class="kw">unique</span>(raw.skyline<span class="op">$</span>FileName))</code></pre>
<pre><code>## character(0)</code></pre>
<p>There is no issue in this annotation.</p>
<p>Let’s try the example with unmatched information.</p>
<pre class="sourceCode r"><code class="sourceCode r">annot.wrong &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;data/data_Skyline/ABRF2015_Skyline_annotation_wrong_example.csv&quot;</span>)
annot.wrong</code></pre>
<pre><code>##                          Run  Condition BioReplicate
## 1  JD_06232014_sample1_A.raw Condition1            1
## 2  JD_06232014_sample2_A.raw Condition2            2
## 3  JD_06232014_sample4_B.raw Condition4            4
## 4  JD_06232014_sample1_B.raw Condition1            1
## 5  JD_06232014_sample1_C.raw Condition1            1
## 6  JD_06232014_sample2_B.raw Condition2            2
## 7  JD_06232014_sample2_C.raw Condition2            2
## 8  JD_06232014_sample3_A.raw Condition3            3
## 9  JD_06232014_sample3_B.raw Condition3            3
## 10 JD_06232014_sample3_C.raw Condition3            3
## 11 JD_06232014_sample4-A.raw Condition4            4
## 12 JD_06232014_sample4_C.raw Condition4            4</code></pre>
<p><strong>Note!</strong> small details : hyphen vs underline.</p>
</div>
<div id="common-mistake-for-annotation-file-incorrect-bioreplicate-information" class="section level6">
<h6><span class="header-section-number">2.1.6.1.2.2</span> Common mistake for annotation file : Incorrect <code>BioReplicate</code> information</h6>
<p><code>MSstats</code> distinguish the design of experiment as group comparison, time course, paired design, with the combination of <code>Condition</code>, <code>BioReplicate</code>, and <code>Run</code>.</p>
</div>
<div id="group-comparison" class="section level6">
<h6><span class="header-section-number">2.1.6.1.2.3</span> Group comparison</h6>
<p><img src="img/expdesign_group.png" style="width:40.0%" /></p>
<p>In a group comparison design, the conditions (e.g., disease states) are profiled across <strong>non-overlapping sets of biological replicates (i.e., subjects)</strong>. In this example there are 2 conditions, Disease and Control (in general the number of conditions can vary). There are 3 subjects (i.e., biological replicates) per condition (in general an equal number of replicates per condition is not required). Overall, in this example there are 2 × 3 = 6 mass spectrometry runs.</p>
<p>The most important is that 1) subject IDs for disease group are completely different thatn subject IDs for control group 2) <code>Run</code> is not order of spectral acquisition, but just unique MS run ID.</p>
<p><img src="img/expdesign_group_tech.png" /></p>
<p>In addition, if each subject has e technical replicate runs (in general technical replicates are not required, and their number per sample may vary). there are 2 × 3 × 3 = 18 mass spectrometry runs.</p>
</div>
<div id="time-course" class="section level6">
<h6><span class="header-section-number">2.1.6.1.2.4</span> Time course</h6>
<p>The important feature of a time course experimental design is that <strong>a same subject (i.e., biological replicate) is repetitively measured across multiple time points</strong>. In this example there are 3 time points, Time1, Time2, and Time3 (in general the number of times can vary). There are 3 subjects (i.e., biological replicates) measured across times (in general an equal number of times per replicate is not required). There are no technical replicates (in general the number of technical replicates per sample may vary). Overall, in this example there are 3 × 3 = 9 mass spectrometry runs.</p>
<p><img src="img/expdesign_time.png" style="width:60.0%" /></p>
</div>
<div id="paired-design" class="section level6">
<h6><span class="header-section-number">2.1.6.1.2.5</span> Paired design</h6>
<p>Another frequently used experimental design is a <em>paired design</em>, where measurements from <strong>multiple conditions (such as healthy biopsy and disease biopsy) are taken from a same subject</strong>. The statistical model for this experimental design is the same as in the time course experiment, however the values in the columns of the input data may have a different appearence. In this example there are 3 subjects (in general the number of patients can vary). There are three conditions per subject (in general the number of conditions per subject can exceed two). Overall, in this example there are <span class="math inline">\(2 \times 3 = 6\)</span> mass spectrometry runs. <code>BioReplicate</code> should indicate each individual ID.</p>
<p><img src="img/expdesign_pair.png" style="width:60.0%" /></p>
</div>
</div>
<div id="preprocessing-with-skylinetomsstatsformat" class="section level5">
<h5><span class="header-section-number">2.1.6.1.3</span> Preprocessing with <code>SkylinetoMSstatsFormat</code></h5>
<p>The input data for <code>MSstats</code> is required to contain variables of <strong>ProteinName</strong>, <strong>PeptideSequence</strong>, <strong>PrecursorCharge</strong>, <strong>FragmentIon</strong>, <strong>ProductCharge</strong>, <strong>IsotopeLabelType</strong>, <strong>Condition</strong>, <strong>BioReplicate</strong>, <strong>Run</strong>, <strong>Intensity</strong>. These variable names should be fixed. <code>MSstats</code> input from Skyline adapts the column scheme of the dataset so that it fits <code>MSstats</code> input format. However there are several extra column names and also some of them need to be changed. <code>SkylinetoMSstatsFormat</code> function helps pre-processing for making right format of MSstats input from Skyline output. For example, it renames some column name, and replace truncated peak intensities with NA. Another important step is to handle isotopic peaks before using <code>dataProcess</code>. The output from Skyline for DDA experiment has several measurements of peak area from the monoisotopic, M+1 and M+2 peaks. To get a robust measure of peptide intensity, we can sum over isotopic peaks per peptide or use the highest peak. Here we take a summation per peptide ion.</p>
<p>Here is the summary of pre-processing steps in <code>SkylinetoMSstatsFormat</code> function (in orange box below).</p>
<p><img src="img/MSstats_Skyline.png" /></p>
<p>For further details, visit the help file using the following code.</p>
<pre class="sourceCode r"><code class="sourceCode r">?SkylinetoMSstatsFormat</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reformating and pre-processing for Skyline output.</span>
input.skyline &lt;-<span class="st"> </span><span class="kw">SkylinetoMSstatsFormat</span>(raw.skyline, 
                                        <span class="dt">annotation=</span>annot.skyline,
                                        <span class="dt">removeProtein_with1Feature =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>## ** Proteins, which names include DECOY, are removed.</code></pre>
<pre><code>## ** Peptides, that are used in more than one proteins, are removed.</code></pre>
<pre><code>## Warning in SkylinetoMSstatsFormat(raw.skyline, annotation =
## annot.skyline, : NAs introduced by coercion</code></pre>
<pre><code>## ** Truncated peaks are replaced with NA.</code></pre>
<pre><code>## ** For DDA datasets, three isotopic peaks per feature and run are summed.</code></pre>
<pre><code>## ** 4 features have all NAs or zero intensity values and are removed.</code></pre>
<pre><code>## ** 13 features have 1 or 2 intensities across runs and are removed.</code></pre>
<pre><code>## ** All proteins have at least two features.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.skyline)</code></pre>
<pre><code>##            ProteinName             PeptideSequence PrecursorCharge
## 1 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK               3
## 2 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK               3
## 3 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK               3
## 4 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK               3
## 5 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK               3
## 6 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK               3
##   FragmentIon ProductCharge IsotopeLabelType  Condition BioReplicate
## 1         sum            NA                L Condition1            1
## 2         sum            NA                L Condition2            2
## 3         sum            NA                L Condition4            4
## 4         sum            NA                L Condition2            2
## 5         sum            NA                L Condition4            4
## 6         sum            NA                L Condition3            3
##                         Run Intensity StandardType
## 1 JD_06232014_sample1_C.raw   7863713           NA
## 2 JD_06232014_sample2_A.raw    977615           NA
## 3 JD_06232014_sample4_B.raw   4102785           NA
## 4 JD_06232014_sample2_C.raw   6547299           NA
## 5 JD_06232014_sample4_C.raw   3972464           NA
## 6 JD_06232014_sample3_B.raw   8896052           NA</code></pre>
</div>
<div id="preliminary-check" class="section level5">
<h5><span class="header-section-number">2.1.6.1.4</span> Preliminary check</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="kw">unique</span>(input.skyline<span class="op">$</span>ProteinName)) </code></pre>
<pre><code>## [1] 3027</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.skyline<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 219</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.skyline<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.skyline<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 2414</code></pre>
<hr />
</div>
</div>
<div id="maxquant-output" class="section level4">
<h4><span class="header-section-number">2.1.6.2</span> MaxQuant output</h4>
<div id="read-data-1" class="section level5">
<h5><span class="header-section-number">2.1.6.2.1</span> Read data</h5>
<p>Three files should be prepared before MSstats. Two files, ‘proteinGroups.txt’ and ‘evidence.txt’ are outputs
from MaxQuant.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, get protein ID information</span>
proteinGroups &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/data_MaxQuant/proteinGroups.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read in MaxQuant file: evidence.txt</span>
evi &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/data_MaxQuant/evidence.txt&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)
<span class="kw">colnames</span>(evi)</code></pre>
<pre><code>##  [1] &quot;Sequence&quot;                           
##  [2] &quot;Length&quot;                             
##  [3] &quot;Modifications&quot;                      
##  [4] &quot;Modified.sequence&quot;                  
##  [5] &quot;Oxidation..M..Probabilities&quot;        
##  [6] &quot;Oxidation..M..Score.Diffs&quot;          
##  [7] &quot;Acetyl..Protein.N.term.&quot;            
##  [8] &quot;Oxidation..M.&quot;                      
##  [9] &quot;Missed.cleavages&quot;                   
## [10] &quot;Proteins&quot;                           
## [11] &quot;Leading.proteins&quot;                   
## [12] &quot;Leading.razor.protein&quot;              
## [13] &quot;Gene.names&quot;                         
## [14] &quot;Protein.names&quot;                      
## [15] &quot;Type&quot;                               
## [16] &quot;Raw.file&quot;                           
## [17] &quot;MS.MS.m.z&quot;                          
## [18] &quot;Charge&quot;                             
## [19] &quot;m.z&quot;                                
## [20] &quot;Mass&quot;                               
## [21] &quot;Resolution&quot;                         
## [22] &quot;Uncalibrated...Calibrated.m.z..ppm.&quot;
## [23] &quot;Uncalibrated...Calibrated.m.z..Da.&quot; 
## [24] &quot;Mass.Error..ppm.&quot;                   
## [25] &quot;Mass.Error..Da.&quot;                    
## [26] &quot;Uncalibrated.Mass.Error..ppm.&quot;      
## [27] &quot;Uncalibrated.Mass.Error..Da.&quot;       
## [28] &quot;Max.intensity.m.z.0&quot;                
## [29] &quot;Retention.time&quot;                     
## [30] &quot;Retention.length&quot;                   
## [31] &quot;Calibrated.retention.time&quot;          
## [32] &quot;Calibrated.retention.time.start&quot;    
## [33] &quot;Calibrated.retention.time.finish&quot;   
## [34] &quot;Retention.time.calibration&quot;         
## [35] &quot;Match.time.difference&quot;              
## [36] &quot;Match.m.z.difference&quot;               
## [37] &quot;Match.q.value&quot;                      
## [38] &quot;Match.score&quot;                        
## [39] &quot;Number.of.data.points&quot;              
## [40] &quot;Number.of.scans&quot;                    
## [41] &quot;Number.of.isotopic.peaks&quot;           
## [42] &quot;PIF&quot;                                
## [43] &quot;Fraction.of.total.spectrum&quot;         
## [44] &quot;Base.peak.fraction&quot;                 
## [45] &quot;PEP&quot;                                
## [46] &quot;MS.MS.Count&quot;                        
## [47] &quot;MS.MS.Scan.Number&quot;                  
## [48] &quot;Score&quot;                              
## [49] &quot;Delta.score&quot;                        
## [50] &quot;Combinatorics&quot;                      
## [51] &quot;Intensity&quot;                          
## [52] &quot;Reverse&quot;                            
## [53] &quot;Potential.contaminant&quot;              
## [54] &quot;id&quot;                                 
## [55] &quot;Protein.group.IDs&quot;                  
## [56] &quot;Peptide.ID&quot;                         
## [57] &quot;Mod..peptide.ID&quot;                    
## [58] &quot;MS.MS.IDs&quot;                          
## [59] &quot;Best.MS.MS&quot;                         
## [60] &quot;AIF.MS.MS.IDs&quot;                      
## [61] &quot;Oxidation..M..site.IDs&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(evi<span class="op">$</span>Raw.file)</code></pre>
<pre><code>##  [1] JD_06232014_sample1-A JD_06232014_sample2_A JD_06232014_sample4_B
##  [4] JD_06232014_sample1_B JD_06232014_sample1_C JD_06232014_sample2_B
##  [7] JD_06232014_sample2_C JD_06232014_sample3_A JD_06232014_sample3_B
## [10] JD_06232014_sample3_C JD_06232014_sample4-A JD_06232014_sample4_C
## 12 Levels: JD_06232014_sample1_B ... JD_06232014_sample4-A</code></pre>
<p>One file is for annotation information, required to fill in Condition and BioReplicate for corresponding Run information. Users have to prepare as csv or txt file like ‘ABRF2015_MaxQuant_annotation.csv’, which includes <strong>Run</strong>, <strong>Condition</strong>, and <strong>BioReplicate</strong> information, and load it in R.</p>
</div>
<div id="set-annotation-file-1" class="section level5">
<h5><span class="header-section-number">2.1.6.2.2</span> Set annotation file</h5>
<p>Annotation information is required to fill in <strong>Condition</strong> and <strong>BioReplicate</strong> for corresponding <strong>Raw.file</strong> information. Users have to prepare as csv or txt file like ‘ABRF2015_MaxQuant_annotation.csv’, which includes <strong>Raw.file</strong>, <strong>Condition</strong>, and <strong>BioReplicate</strong> information, and load it in R. <strong>Raw.file</strong> column in the annotation file should be the same as unique <strong>Raw.file</strong> in evidence.txt file.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read in annotation including condition and biological replicates: annotation.csv</span>
annot.maxquant &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/data_MaxQuant/ABRF2015_MaxQuant_annotation.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)
annot.maxquant</code></pre>
<pre><code>##                 Raw.file  Condition BioReplicate IsotopeLabelType
## 1  JD_06232014_sample1-A Condition1            1                L
## 2  JD_06232014_sample2_A Condition2            2                L
## 3  JD_06232014_sample4_B Condition4            4                L
## 4  JD_06232014_sample1_B Condition1            1                L
## 5  JD_06232014_sample1_C Condition1            1                L
## 6  JD_06232014_sample2_B Condition2            2                L
## 7  JD_06232014_sample2_C Condition2            2                L
## 8  JD_06232014_sample3_A Condition3            3                L
## 9  JD_06232014_sample3_B Condition3            3                L
## 10 JD_06232014_sample3_C Condition3            3                L
## 11 JD_06232014_sample4-A Condition4            4                L
## 12 JD_06232014_sample4_C Condition4            4                L</code></pre>
</div>
<div id="preprocessing-with-maxqtomsstatsformat" class="section level5">
<h5><span class="header-section-number">2.1.6.2.3</span> Preprocessing with <code>MaxQtoMSstatsFormat</code></h5>
<p><code>MaxQtoMSstatsFormat</code> function helps pre-processing for making right format of MSstats input from MaxQuant output. Basically, this function gets peptide ion intensity from <code>‘evidence.txt’</code> file. In addition, there are several steps to filter out or to modify the data in order to get required information.</p>
<p>Here is the summary of pre-processing steps in <code>MaxQtoMSstatsFormat</code> function (in orange box below).</p>
<p><img src="img/MSstats_MaxQ.png" /></p>
<pre class="sourceCode r"><code class="sourceCode r">?MaxQtoMSstatsFormat</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reformating and pre-processing for MaxQuant output.</span>
<span class="co"># no protein with 1 peptide</span>
input.maxquant &lt;-<span class="st"> </span><span class="kw">MaxQtoMSstatsFormat</span>(<span class="dt">evidence=</span>evi, 
                                      <span class="dt">annotation=</span>annot.maxquant,
                                      <span class="dt">proteinGroups=</span>proteinGroups,
                                      <span class="dt">removeProtein_with1Peptide=</span><span class="ot">TRUE</span>)</code></pre>
<pre><code>## ** + Contaminant, + Reverse, + Only.identified.by.site, proteins are removed.</code></pre>
<pre><code>## ** Peptide and charge, that have 1 or 2 measurements across runs, are removed.</code></pre>
<pre><code>## ** 282 proteins, which have only peptide and charge in a protein, are removed among 3157 proteins.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.maxquant)</code></pre>
<pre><code>##   ProteinName        PeptideSequence PrecursorCharge FragmentIon
## 1      D6VTK4 EGEVEPVDMYTPDTAADEEARK               3          NA
## 2      D6VTK4    FYPGTLSSFQTDSINNDAK               2          NA
## 3      D6VTK4             IGPFADASYK               2          NA
## 4      D6VTK4          NQFYQLPTPTSSK               2          NA
## 5      D6VTK4           TFVSETADDIEK               2          NA
## 6      D6VTK4         TNTITSDFTTSTDR               2          NA
##   ProductCharge IsotopeLabelType  Condition BioReplicate
## 1            NA                L Condition1            1
## 2            NA                L Condition1            1
## 3            NA                L Condition1            1
## 4            NA                L Condition1            1
## 5            NA                L Condition1            1
## 6            NA                L Condition1            1
##                     Run Intensity
## 1 JD_06232014_sample1_B  87141000
## 2 JD_06232014_sample1_B  46167000
## 3 JD_06232014_sample1_B  45425000
## 4 JD_06232014_sample1_B  47094000
## 5 JD_06232014_sample1_B        NA
## 6 JD_06232014_sample1_B  62786000</code></pre>
</div>
<div id="preliminary-check-1" class="section level5">
<h5><span class="header-section-number">2.1.6.2.4</span> Preliminary check</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="kw">unique</span>(input.maxquant<span class="op">$</span>ProteinName)) </code></pre>
<pre><code>## [1] 2875</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.maxquant<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 40056</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.maxquant<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.maxquant<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 0</code></pre>
<blockquote>
<p>Challenge</p>
<ul>
<li>Let’s check unique information for <code>Run</code>,<code>BioReplicate</code> and <code>Condition</code> in <code>input.maxquant</code>.</li>
</ul>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(input.maxquant[, <span class="kw">c</span>(<span class="st">&#39;Run&#39;</span>, <span class="st">&#39;BioReplicate&#39;</span>, <span class="st">&#39;Condition&#39;</span>)])</code></pre>
<pre><code>##                          Run BioReplicate  Condition
## 1      JD_06232014_sample1_B            1 Condition1
## 30600  JD_06232014_sample1_C            1 Condition1
## 61199  JD_06232014_sample1-A            1 Condition1
## 91798  JD_06232014_sample2_A            2 Condition2
## 122397 JD_06232014_sample2_B            2 Condition2
## 152996 JD_06232014_sample2_C            2 Condition2
## 183595 JD_06232014_sample3_A            3 Condition3
## 214194 JD_06232014_sample3_B            3 Condition3
## 244793 JD_06232014_sample3_C            3 Condition3
## 275392 JD_06232014_sample4_B            4 Condition4
## 305991 JD_06232014_sample4_C            4 Condition4
## 336590 JD_06232014_sample4-A            4 Condition4</code></pre>
<hr />
</div>
</div>
<div id="openms-output" class="section level4">
<h4><span class="header-section-number">2.1.6.3</span> OpenMS output</h4>
<div id="read-data-2" class="section level5">
<h5><span class="header-section-number">2.1.6.3.1</span> Read data</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, read output of OpenMS</span>
raw.openMS &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/data_OpenMS/ABRF2015_OpenMS_raw.csv&quot;</span>, <span class="dt">stringsAsFactors=</span>F) <span class="co"># the data file</span>
<span class="kw">head</span>(raw.openMS)</code></pre>
<pre><code>##            ProteinName PeptideSequence PrecursorCharge FragmentIon
## 1 sp|P09938|RIR2_YEAST    AAADALSDLEIK               2          NA
## 2 sp|P09938|RIR2_YEAST    AAADALSDLEIK               2          NA
## 3 sp|P09938|RIR2_YEAST    AAADALSDLEIK               2          NA
## 4 sp|P09938|RIR2_YEAST    AAADALSDLEIK               2          NA
## 5 sp|P09938|RIR2_YEAST    AAADALSDLEIK               2          NA
## 6 sp|P09938|RIR2_YEAST    AAADALSDLEIK               2          NA
##   ProductCharge IsotopeLabelType Condition BioReplicate Run Intensity
## 1             0                L         1            1   1 391797000
## 2             0                L         4            4  10 103656000
## 3             0                L         4            4  11 361107000
## 4             0                L         1            1   2 456756000
## 5             0                L         1            1   3 389268000
## 6             0                L         2            2   4 433488000</code></pre>
</div>
<div id="set-annotation-file-2" class="section level5">
<h5><span class="header-section-number">2.1.6.3.2</span> Set annotation file</h5>
<p>The output from <code>OpenMS</code> already includes <code>Run</code>, <code>BioReplicate</code>, <code>Condition</code> information. Let’s check it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(raw.openMS[, <span class="kw">c</span>(<span class="st">&#39;Run&#39;</span>, <span class="st">&#39;BioReplicate&#39;</span>, <span class="st">&#39;Condition&#39;</span>)])</code></pre>
<pre><code>##    Run BioReplicate Condition
## 1    1            1         1
## 2   10            4         4
## 3   11            4         4
## 4    2            1         1
## 5    3            1         1
## 6    4            2         2
## 7    5            2         2
## 8    6            2         2
## 9    7            3         3
## 10   8            3         3
## 11   9            3         3
## 14  12            4         4</code></pre>
</div>
<div id="preprocessing-with-openmstomsstatsformat" class="section level5">
<h5><span class="header-section-number">2.1.6.3.3</span> Preprocessing with <code>OpenMStoMSstatsFormat</code></h5>
<p>There are several steps to filter out or to modify the data in order to get required information.
Here is the summary of pre-processing steps in <code>OpenMStoMSstatsFormat</code> function.</p>
<p><img src="img/MSstats_OpenMS.png" /></p>
<pre class="sourceCode r"><code class="sourceCode r">?OpenMStoMSstatsFormat</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reformating and pre-processing for OpenMS output.</span>
input.openms &lt;-<span class="st"> </span><span class="kw">OpenMStoMSstatsFormat</span>(raw.openMS,
                                      <span class="dt">removeProtein_with1Feature=</span><span class="ot">TRUE</span>)</code></pre>
<pre><code>## ** 0 features have all NAs or zero intensity values and are removed.</code></pre>
<pre><code>## ** All peptides are unique peptides in proteins.</code></pre>
<pre><code>## ** 909 features have 1 or 2 intensities across runs and are removed.</code></pre>
<pre><code>## ** 698 proteins, which have only one feature in a protein, are removed among 2538 proteins.</code></pre>
<pre><code>## ** No multiple measurements in a feature and a run.</code></pre>
<pre><code>## Warning in OpenMStoMSstatsFormat(raw.openMS, removeProtein_with1Feature =
## TRUE): NAs introduced by coercion</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## now &#39;input.openms&#39; is ready for MSstats</span>
<span class="kw">head</span>(input.openms)</code></pre>
<pre><code>##            ProteinName        PeptideSequence PrecursorCharge FragmentIon
## 1 sp|D6VTK4|STE2_YEAST EGEVEPVDMYTPDTAADEEARK               3          NA
## 2 sp|D6VTK4|STE2_YEAST    FYPGTLSSFQTDSINNDAK               2          NA
## 3 sp|D6VTK4|STE2_YEAST             IGPFADASYK               2          NA
## 4 sp|D6VTK4|STE2_YEAST          NQFYQLPTPTSSK               2          NA
## 5 sp|D6VTK4|STE2_YEAST           TFVSETADDIEK               2          NA
## 6 sp|D6VTK4|STE2_YEAST         TNTITSDFTTSTDR               2          NA
##   ProductCharge IsotopeLabelType Condition BioReplicate Run Intensity
## 1             0                L         1            1   1  64757900
## 2             0                L         1            1   1  38852700
## 3             0                L         1            1   1  73225800
## 4             0                L         1            1   1  63139900
## 5             0                L         1            1   1        NA
## 6             0                L         1            1   1  58905300</code></pre>
</div>
<div id="preliminary-check-for-preprocessed-data" class="section level5">
<h5><span class="header-section-number">2.1.6.3.4</span> Preliminary check for preprocessed data</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="kw">unique</span>(input.openms<span class="op">$</span>ProteinName)) </code></pre>
<pre><code>## [1] 1840</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.openms<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 21962</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.openms<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.openms<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(input.openms<span class="op">$</span>Run)</code></pre>
<pre><code>## 
##     1     2     3     4     5     6     7     8     9    10    11    12 
## 15560 15560 15560 15560 15560 15560 15560 15560 15560 15560 15560 15560</code></pre>
<blockquote>
<p>Challenge</p>
<ul>
<li>Let’s check unique information for <code>Run</code>,<code>BioReplicate</code> and <code>Condition</code>.</li>
</ul>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(input.openms[, <span class="kw">c</span>(<span class="st">&#39;Run&#39;</span>, <span class="st">&#39;BioReplicate&#39;</span>, <span class="st">&#39;Condition&#39;</span>)]) </code></pre>
<pre><code>##        Run BioReplicate Condition
## 1        1            1         1
## 15561   10            4         4
## 31121   11            4         4
## 46681   12            4         4
## 62241    2            1         1
## 77801    3            1         1
## 93361    4            2         2
## 108921   5            2         2
## 124481   6            2         2
## 140041   7            3         3
## 155601   8            3         3
## 171161   9            3         3</code></pre>
<hr />
</div>
</div>
<div id="progenesis-output" class="section level4">
<h4><span class="header-section-number">2.1.6.4</span> Progenesis output</h4>
<div id="read-data-3" class="section level5">
<h5><span class="header-section-number">2.1.6.4.1</span> Read data</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, read output of Progenesis</span>
raw.progenesis &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/data_Progenesis/ABRF2015_Progenesis_raw.csv&quot;</span>, <span class="dt">stringsAsFactors=</span>F) <span class="co"># the data file</span>
<span class="kw">head</span>(raw.progenesis)</code></pre>
<pre><code>##       X                  X.1    X.2              X.3              X.4
## 1                                                                    
## 2     # Retention time (min) Charge              m/z    Measured mass
## 3    16     52.5563333333333      2 501.781277638303 1001.54800234285
## 4    32             38.15255      2 474.251481407549 946.488409881339
## 5 11167     36.2224333333333      2  474.25154745893 946.488541984099
## 6    41              45.5598      2 371.731536419815 741.448519905869
##                    X.5               X.6    X.7       X.8           X.9
## 1                                                                      
## 2       Mass error (u)  Mass error (ppm)  Score  Sequence Modifications
## 3 -0.00255665715405939 -2.55269904358308      1 TANDVLTIR              
## 4 -0.00219111866147159 -2.31499251990099      1 VTDGVMVAR              
## 5  -0.0020590159006133 -2.17542139186367      1 VTDGVMVAR              
## 6 -0.00120309413080122 -1.62262402086192 0.9996   AGLNIVR              
##                    X.10
## 1                      
## 2             Accession
## 3 sp|P00549|KPYK1_YEAST
## 4 sp|P00549|KPYK1_YEAST
## 5 sp|P00549|KPYK1_YEAST
## 6 sp|P00549|KPYK1_YEAST
##                                                                                             X.11
## 1                                                                                               
## 2                                                                                    Description
## 3 Pyruvate kinase 1 OS=Saccharomyces cerevisiae (strain ATCC 204508 \\ S288c) GN=CDC19 PE=1 SV=2
## 4 Pyruvate kinase 1 OS=Saccharomyces cerevisiae (strain ATCC 204508 \\ S288c) GN=CDC19 PE=1 SV=2
## 5 Pyruvate kinase 1 OS=Saccharomyces cerevisiae (strain ATCC 204508 \\ S288c) GN=CDC19 PE=1 SV=2
## 6 Pyruvate kinase 1 OS=Saccharomyces cerevisiae (strain ATCC 204508 \\ S288c) GN=CDC19 PE=1 SV=2
##                  X.12             X.13                   X.14
## 1                                                            
## 2 Use in quantitation  Max fold change Highest mean condition
## 3               False 1.23101575731737                      A
## 4               False 1.35108253622201                      B
## 5               False 1.25419527606242                      B
## 6               False 1.04868912680216                      A
##                    X.15               X.16             X.17
## 1                                                          
## 2 Lowest mean condition              Anova       Maximum CV
## 3                     C 0.0522715538027003 12.0175133289667
## 4                     A 0.0393818452091522 26.8776079679151
## 5                     A  0.253277920596793 27.2310093101224
## 6                     B  0.993981434364646 27.0631636013386
##    Normalized.abundance                  X.18                  X.19
## 1                     A                                            
## 2 JD_06232014_sample1-A JD_06232014_sample2_A JD_06232014_sample3_A
## 3      234646642.659118      246323351.490501       306102714.66799
## 4      179120293.733639      104309665.701784      136741892.392964
## 5      2233197.90782367       1134566.5998162      1574437.81004362
## 6      123797188.716029       122761256.64621      116107425.243685
##                    X.20                  X.21                  X.22
## 1                                           B                      
## 2 JD_06232014_sample4-A JD_06232014_sample1_B JD_06232014_sample2_B
## 3      257629531.217182      235779468.539422      236753257.546934
## 4      105011188.469111      182469696.644175      183285243.781685
## 5      1701362.72342001      2336796.51015815      1788630.29256942
## 6       63610598.879437      108255803.660911      108785457.069653
##                    X.23                  X.24                  X.25
## 1                                                                 C
## 2 JD_06232014_sample3_B JD_06232014_sample4_B JD_06232014_sample1_C
## 3      186699807.218591      242959514.796972      223435557.783206
## 4      162853464.030243      180957229.609825      186073547.948691
## 5      1932732.32106691      2274168.76697097       2182403.4051037
## 6      92469286.5619254      96974519.2450418      115737794.475905
##                    X.26                  X.27                  X.28
## 1                                                                  
## 2 JD_06232014_sample2_C JD_06232014_sample3_C JD_06232014_sample4_C
## 3      220456628.684641      197285091.954229      207473304.500931
## 4      163946644.909844      150247529.397207      176820166.306319
## 5       2040841.8048229      1497501.50492545      2156318.09540588
## 6      100428622.768589      109442962.863466      83998024.0208531
##           Raw.abundance                  X.29                  X.30
## 1                     A                                            
## 2 JD_06232014_sample1-A JD_06232014_sample2_A JD_06232014_sample3_A
## 3      244531299.931508      221199440.186087      277078923.760572
## 4      186665863.932395      93670533.1411598      123776414.130536
## 5      2327272.96336292      1018845.73758267       1425154.0840074
## 6      129012233.635811      110240142.001841      105098448.610706
##                    X.31                  X.32                  X.33
## 1                                           B                      
## 2 JD_06232014_sample4-A JD_06232014_sample1_B JD_06232014_sample2_B
## 3      213112377.670857       265826760.55748      265610928.042007
## 4      86865756.2312952      205723291.596601       205625739.64841
## 5      1407375.36397932      2634593.46237989      2006645.04833363
## 6      52618990.9526949      122051719.672593       122045231.85501
##                    X.34                  X.35                  X.36
## 1                                                                 C
## 2 JD_06232014_sample3_B JD_06232014_sample4_B JD_06232014_sample1_C
## 3      219812880.452275      242959514.796972      210648874.118526
## 4      191737150.420336      180957229.609825      175425002.929311
## 5      2275521.67817463      2274168.76697097      2057509.66730008
## 6      108869636.960823      96974519.2450418      109114396.746851
##                    X.37                  X.38                  X.39
## 1                                                                  
## 2 JD_06232014_sample2_C JD_06232014_sample3_C JD_06232014_sample4_C
## 3      207260386.701525      217212520.118758      194785326.277837
## 4      154133015.755399      165423774.187439      166006773.109084
## 5      1918679.71576989       1648761.5589421      2024448.99975338
## 6      94417098.3431607      120497608.498225      78861145.7987456
##         Spectral.counts                  X.40                  X.41
## 1                     A                                            
## 2 JD_06232014_sample1-A JD_06232014_sample2_A JD_06232014_sample3_A
## 3                     2                     1                     1
## 4                     1                     1                     1
## 5                     1                     0                     1
## 6                     2                     2                     2
##                    X.42                  X.43                  X.44
## 1                                           B                      
## 2 JD_06232014_sample4-A JD_06232014_sample1_B JD_06232014_sample2_B
## 3                     3                     2                     3
## 4                     1                     1                     1
## 5                     1                     0                     0
## 6                     2                     2                     2
##                    X.45                  X.46                  X.47
## 1                                                                 C
## 2 JD_06232014_sample3_B JD_06232014_sample4_B JD_06232014_sample1_C
## 3                     2                     2                     2
## 4                     1                     1                     1
## 5                     0                     1                     1
## 6                     2                     2                     2
##                    X.48                  X.49                  X.50
## 1                                                                  
## 2 JD_06232014_sample2_C JD_06232014_sample3_C JD_06232014_sample4_C
## 3                     3                     1                     2
## 4                     1                     1                     1
## 5                     0                     1                     0
## 6                     2                     2                     2</code></pre>
<p>One file is for annotation information, required to fill in Condition and BioReplicate for corresponding Run information. Users have to prepare as csv or txt file like ‘ABRF2015_Progenesis_annotation.csv’, which includes <strong>Run</strong>, <strong>Condition</strong>, and <strong>BioReplicate</strong> information, and load it in R.</p>
</div>
<div id="set-annotation-file-3" class="section level5">
<h5><span class="header-section-number">2.1.6.4.2</span> Set annotation file</h5>
<p>Annotation information is required to fill in <strong>Condition</strong> and <strong>BioReplicate</strong> for corresponding <strong>Run</strong> information. Users have to prepare as csv or txt file like ‘ABRF2015_Progenesis_annotation.csv’, which includes <strong>Run</strong>, <strong>Condition</strong>, and <strong>BioReplicate</strong> information, and load it in R.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## Read in annotation including condition and biological replicates: ABRF2015_Progenesis_annotation.csv</span>
annot.progenesis &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/data_Progenesis/ABRF2015_Progenesis_annotation.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)
annot.progenesis</code></pre>
<pre><code>##                      Run  Condition BioReplicate
## 1  JD_06232014_sample1-A Condition1            1
## 2  JD_06232014_sample2_A Condition2            2
## 3  JD_06232014_sample4_B Condition4            4
## 4  JD_06232014_sample1_B Condition1            1
## 5  JD_06232014_sample1_C Condition1            1
## 6  JD_06232014_sample2_B Condition2            2
## 7  JD_06232014_sample2_C Condition2            2
## 8  JD_06232014_sample3_A Condition3            3
## 9  JD_06232014_sample3_B Condition3            3
## 10 JD_06232014_sample3_C Condition3            3
## 11 JD_06232014_sample4-A Condition4            4
## 12 JD_06232014_sample4_C Condition4            4</code></pre>
<p>!! <code>Run</code> information should be the same as annotated in output of <code>Progenesis</code>.</p>
</div>
<div id="preprocessing-with-progenesistomsstatsformat" class="section level5">
<h5><span class="header-section-number">2.1.6.4.3</span> Preprocessing with <code>ProgenesistoMSstatsFormat</code></h5>
<p>The output from <code>Progenesis</code> includes peptide ion-level quantification for each MS runs. <code>ProgenesistoMSstatsFormat</code> function helps pre-processing for making right format of <code>MSstats</code> input from <code>Progenesis</code> output. Basically, this function reformats wide format to long format. It provide <strong>Raw.abundance</strong>, <strong>Normalized.abundance</strong> and <strong>Spectral count</strong> columns. This converter uses <strong>Raw.abundance</strong> columns for Intensity values. In addition, there are several steps to filter out or to modify the data in order to get required information.
Here is the summary of pre-processing steps in <code>ProgenesistoMSstatsFormat</code> function (in orange box below).</p>
<p><img src="img/MSstats_progenesis.png" /></p>
<pre class="sourceCode r"><code class="sourceCode r">?ProgenesistoMSstatsFormat</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reformating and pre-processing for Progenesis output.</span>
input.progenesis &lt;-<span class="st"> </span><span class="kw">ProgenesistoMSstatsFormat</span>(raw.progenesis, 
                                              <span class="dt">annotation=</span>annot.progenesis,
                                              <span class="dt">removeProtein_with1Peptide=</span><span class="ot">TRUE</span>)</code></pre>
<pre><code>## ** Peptides, that are used in more than one proteins, are removed.</code></pre>
<pre><code>## ** Multiple measurements in a feature and a run are summarized by summaryforMultipleRows.</code></pre>
<pre><code>## ** 898 proteins, which have only one feature in a protein, are removed among 3913 proteins.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## now &#39;input.progenesis&#39; is ready for MSstats</span>
<span class="kw">head</span>(input.progenesis)</code></pre>
<pre><code>##             ProteinName       PeptideModifiedSequence PrecursorCharge
## 1 sp|A5Z2X5|YP010_YEAST              LTGNPELSSLDEVLAK               2
## 2 sp|A5Z2X5|YP010_YEAST RPAQLLL[N-term] nTerm+42.0106               2
## 3  sp|D6VTK4|STE2_YEAST        EGEVEPVDMYTPDTAADEEARK               3
## 4  sp|D6VTK4|STE2_YEAST           FYPGTLSSFQTDSINNDAK               2
## 5  sp|D6VTK4|STE2_YEAST                    IGPFADASYK               2
## 6  sp|O13297|CET1_YEAST                   IAGNAVGSVVK               2
##   FragmentIon ProductCharge IsotopeLabelType  Condition BioReplicate
## 1          NA            NA                L Condition1            1
## 2          NA            NA                L Condition1            1
## 3          NA            NA                L Condition1            1
## 4          NA            NA                L Condition1            1
## 5          NA            NA                L Condition1            1
## 6          NA            NA                L Condition1            1
##                     Run Intensity
## 1 JD_06232014_sample1_B 2550357.3
## 2 JD_06232014_sample1_B  865491.8
## 3 JD_06232014_sample1_B 3767734.3
## 4 JD_06232014_sample1_B 2591735.2
## 5 JD_06232014_sample1_B 2301483.1
## 6 JD_06232014_sample1_B  415181.8</code></pre>
</div>
<div id="preliminary-check-for-preprocessed-data-1" class="section level5">
<h5><span class="header-section-number">2.1.6.4.4</span> Preliminary check for preprocessed data</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="kw">unique</span>(input.progenesis<span class="op">$</span>ProteinName)) </code></pre>
<pre><code>## [1] 3015</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.progenesis<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.progenesis<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.progenesis<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 418</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(input.progenesis<span class="op">$</span>Run)</code></pre>
<pre><code>## 
## JD_06232014_sample1-A JD_06232014_sample2_A JD_06232014_sample3_A 
##                  9646                  9646                  9646 
## JD_06232014_sample4-A JD_06232014_sample1_B JD_06232014_sample2_B 
##                  9646                  9646                  9646 
## JD_06232014_sample3_B JD_06232014_sample4_B JD_06232014_sample1_C 
##                  9646                  9646                  9646 
## JD_06232014_sample2_C JD_06232014_sample3_C JD_06232014_sample4_C 
##                  9646                  9646                  9646</code></pre>
<blockquote>
<p>Challenge</p>
<ul>
<li>Let’s check unique information for <code>Run</code>,<code>BioReplicate</code> and <code>Condition</code>.</li>
</ul>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(input.progenesis[, <span class="kw">c</span>(<span class="st">&#39;Run&#39;</span>, <span class="st">&#39;BioReplicate&#39;</span>, <span class="st">&#39;Condition&#39;</span>)]) </code></pre>
<pre><code>##                          Run BioReplicate  Condition
## 1      JD_06232014_sample1_B            1 Condition1
## 10547  JD_06232014_sample1_C            1 Condition1
## 21093  JD_06232014_sample1-A            1 Condition1
## 31639  JD_06232014_sample2_A            2 Condition2
## 42185  JD_06232014_sample2_B            2 Condition2
## 52731  JD_06232014_sample2_C            2 Condition2
## 63277  JD_06232014_sample3_A            3 Condition3
## 73823  JD_06232014_sample3_B            3 Condition3
## 84369  JD_06232014_sample3_C            3 Condition3
## 94915  JD_06232014_sample4_B            4 Condition4
## 105461 JD_06232014_sample4_C            4 Condition4
## 116007 JD_06232014_sample4-A            4 Condition4</code></pre>
<hr />
</div>
</div>
</div>
<div id="save-your-work" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Save your work</h3>
<p>We can save the data that we made so far.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(input.skyline, <span class="dt">file=</span><span class="st">&#39;data/data_Skyline/input.skyline.rda&#39;</span>)
<span class="kw">save</span>(input.maxquant, <span class="dt">file=</span><span class="st">&#39;data/data_MaxQuant/input.maxquant.rda&#39;</span>)
<span class="kw">save</span>(input.openms, <span class="dt">file=</span><span class="st">&#39;data/data_OpenMS/input.openms.rda&#39;</span>)
<span class="kw">save</span>(input.progenesis, <span class="dt">file=</span><span class="st">&#39;data/data_Progenesis/input.progenesis.rda&#39;</span>)</code></pre>
<hr />
</div>
</div>
<div id="data-processing---normalization-and-run-summarization" class="section level2">
<h2><span class="header-section-number">2.2</span> Data processing - Normalization and run summarization</h2>
<div id="dataprocess-with-skyline-data" class="section level3">
<h3><span class="header-section-number">2.2.1</span> dataProcess with Skyline data</h3>
<p>Let’s start processing steps. It includes log transformation of intensities, normalization and run-level summarization.</p>
<p><img src="img/MSstats_dataProcess.png" /></p>
<div id="load-the-pre-processed-data-of-skyline-output" class="section level4">
<h4><span class="header-section-number">2.2.1.1</span> Load the pre-processed data of Skyline output</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_Skyline/input.skyline.rda&#39;</span>)</code></pre>
</div>
<div id="normalizing-and-summarizing-data-with-dataprocess" class="section level4">
<h4><span class="header-section-number">2.2.1.2</span> Normalizing and summarizing data with dataProcess</h4>
<p><strong>! Always pay attention to the default options </strong></p>
<p>To get started with this function, visit the help section of <code>dataProcess</code> first:</p>
<pre class="sourceCode r"><code class="sourceCode r">?dataProcess</code></pre>
<div id="default-normalization-and-summarization-options" class="section level5">
<h5><span class="header-section-number">2.2.1.2.1</span> Default normalization and summarization options</h5>
<p><code>dataProcess</code> perform (1) normalization first. The default option for normalization is <code>equalizeMedians</code>. `equalizeMedians’ fits for label-based SRM experiments, which we can use reference signals. There are three more options for normalization. Depending on the suitable assumption for your experiment, you can choose one of them.</p>
<p>Then, (2) run level summarization will be performed including missing value imputation by accerelated failure model and robust parameter estimation by TMP (Tukey’s median polish).</p>
<p>Below show the default for all options in dataProcess except <code>censoredInt</code>. <code>censoredInt='0'</code> should be used for Skyline output.</p>
<pre class="sourceCode r"><code class="sourceCode r">quant.skyline &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.skyline, 
                             <span class="dt">logTrans=</span><span class="dv">2</span>, 
                             <span class="dt">normalization =</span> <span class="st">&#39;equalizeMedians&#39;</span>,
                             <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                             <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                             <span class="dt">censoredInt=</span><span class="st">&#39;0&#39;</span>,
                             <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                             <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
<p>Let’s check output from <code>dataProcess</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show the name of outputs</span>
<span class="kw">names</span>(quant.skyline)</code></pre>
<pre><code>## [1] &quot;ProcessedData&quot;     &quot;RunlevelData&quot;      &quot;SummaryMethod&quot;    
## [4] &quot;ModelQC&quot;           &quot;PredictBySurvival&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show reformated and normalized data.</span>
<span class="co"># &#39;ABUNDANCE&#39; column has normalized log2 transformed intensities.</span>
<span class="kw">head</span>(quant.skyline<span class="op">$</span>ProcessedData)</code></pre>
<pre><code>##                 PROTEIN                       PEPTIDE TRANSITION
## 10 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK_3     sum_NA
## 16 sp|D6VTK4|STE2_YEAST      EGEVEPVDMYTPDTAADEEARK_3     sum_NA
## 36 sp|D6VTK4|STE2_YEAST         FYPGTLSSFQTDSINNDAK_2     sum_NA
## 37 sp|D6VTK4|STE2_YEAST                  IGPFADASYK_2     sum_NA
## 59 sp|D6VTK4|STE2_YEAST                     KETTSDK_2     sum_NA
## 65 sp|D6VTK4|STE2_YEAST               NQFYQLPTPTSSK_2     sum_NA
##                                 FEATURE LABEL GROUP_ORIGINAL
## 10 EGEVEPVDM[+16]YTPDTAADEEARK_3_sum_NA     L     Condition1
## 16      EGEVEPVDMYTPDTAADEEARK_3_sum_NA     L     Condition1
## 36         FYPGTLSSFQTDSINNDAK_2_sum_NA     L     Condition1
## 37                  IGPFADASYK_2_sum_NA     L     Condition1
## 59                     KETTSDK_2_sum_NA     L     Condition1
## 65               NQFYQLPTPTSSK_2_sum_NA     L     Condition1
##    SUBJECT_ORIGINAL RUN GROUP SUBJECT INTENSITY SUBJECT_NESTED ABUNDANCE
## 10                1   1     1       1   5222795            1.1  22.07301
## 16                1   1     1       1 182195648            1.1  27.19754
## 36                1   1     1       1  86229170            1.1  26.11829
## 37                1   1     1       1 157996653            1.1  26.99194
## 59                1   1     1       1 177684007            1.1  27.16136
## 65                1   1     1       1 140368798            1.1  26.82127
##    FRACTION               originalRUN censored
## 10        1 JD_06232014_sample1_B.raw    FALSE
## 16        1 JD_06232014_sample1_B.raw    FALSE
## 36        1 JD_06232014_sample1_B.raw    FALSE
## 37        1 JD_06232014_sample1_B.raw    FALSE
## 59        1 JD_06232014_sample1_B.raw    FALSE
## 65        1 JD_06232014_sample1_B.raw    FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This table includes run-level summarized log2 intensities. (column : LogIntensities)</span>
<span class="co"># Now one summarized log2 intensities per Protein and Run.</span>
<span class="co"># NumMeasuredFeature : show how many features are used for run-level summarization.</span>
<span class="co">#         If there is no missing value, it should be the number of features in certain protein.</span>
<span class="co"># MissingPercentage : the number of missing features / the number of features in certain protein.</span>
<span class="kw">head</span>(quant.skyline<span class="op">$</span>RunlevelData)</code></pre>
<pre><code>##   RUN              Protein LogIntensities NumMeasuredFeature
## 1   1 sp|D6VTK4|STE2_YEAST       26.81180                  8
## 2   2 sp|D6VTK4|STE2_YEAST       26.60824                  8
## 3   3 sp|D6VTK4|STE2_YEAST       26.58246                  8
## 4   4 sp|D6VTK4|STE2_YEAST       26.83600                  8
## 5   5 sp|D6VTK4|STE2_YEAST       26.79392                  8
## 6   6 sp|D6VTK4|STE2_YEAST       26.60783                  8
##   MissingPercentage more50missing NumImputedFeature
## 1                 0         FALSE                 0
## 2                 0         FALSE                 0
## 3                 0         FALSE                 0
## 4                 0         FALSE                 0
## 5                 0         FALSE                 0
## 6                 0         FALSE                 0
##                 originalRUN GROUP GROUP_ORIGINAL SUBJECT_ORIGINAL
## 1 JD_06232014_sample1_B.raw     1     Condition1                1
## 2 JD_06232014_sample1_C.raw     1     Condition1                1
## 3 JD_06232014_sample1-A.raw     1     Condition1                1
## 4 JD_06232014_sample2_A.raw     2     Condition2                2
## 5 JD_06232014_sample2_B.raw     2     Condition2                2
## 6 JD_06232014_sample2_C.raw     2     Condition2                2
##   SUBJECT_NESTED SUBJECT
## 1            1.1       1
## 2            1.1       1
## 3            1.1       1
## 4            2.2       2
## 5            2.2       2
## 6            2.2       2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show which summarization method is used.</span>
<span class="kw">head</span>(quant.skyline<span class="op">$</span>SummaryMethod)</code></pre>
<pre><code>## [1] &quot;TMP&quot;</code></pre>
<hr />
</div>
</div>
<div id="visualization-of-processed-data" class="section level4">
<h4><span class="header-section-number">2.2.1.3</span> Visualization of processed data</h4>
<div id="quality-control-plots" class="section level5">
<h5><span class="header-section-number">2.2.1.3.1</span> Quality control plots</h5>
<p>Now let’s look at what the equalize medians procedure did to our data. QC plot is good to see the distribution of intensities per MS run and outliers. So, it is good visualization to check normalization. However, not good to see individual intensities.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># QC plot for normalized data with equalize median method</span>
<span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.skyline, 
                 <span class="dt">type=</span><span class="st">&quot;QCplot&quot;</span>, 
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;allonly&#39;</span>,
                 <span class="dt">address=</span><span class="st">&#39;data/data_Skyline/ABRF_skyline_equalizeNorm_&#39;</span>)</code></pre>
<p>Then, <code>ABRF_skyline_equalizeNorm_QCPlot.pdf</code> are generated in the currect directory.</p>
<p><img src="img/ABRF_skyline_equalizeNorm_QCPlot.png" style="width:50.0%" /></p>
<p>Now the median log2 intensities per run across MS runs (lines in the boxes) are the same.</p>
</div>
<div id="profile-plots" class="section level5">
<h5><span class="header-section-number">2.2.1.3.2</span> Profile plots</h5>
<p>Profile plot is good visualization to check individual measurements. Each dot means one intensity. The dots are linked with line per feature. If line is disconnected, that means there is no value (missing value). Color means different peptides and charge stages. Different line type means different transition.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># if you have many MS runs, adjust width of plot (makd wider)</span>
<span class="co"># Profile plot for the data with equalized median method</span>
<span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.skyline, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_Skyline/ABRF_skyline_equalizeNorm_&quot;</span>)</code></pre>
<p><code>ABRF_skyline_equalizeNorm_ProfilePlot.pdf</code> and <code>ABRF_skyline_equalizeNorm_ProfilePlot_wSummarization.pdf</code> are generated in the current directory.</p>
<p>Then, Let’s go though profile plots to see overall quality of data.</p>
<p>There are two pdfs for each protein, first is profile plot with normalized data and second plot is profile plot with normalilzed data and summarized data. This profile plot shows each peptide transition across runs, grouped per condition. Ech peptide has a different colour/type layout.</p>
<p><img src="img/ABRF_skyline_equalizeNorm_ProfilePlot_1.png" style="width:50.0%" /></p>
<p>This plot shows The panel on the right shows the same transitions in grey, with the values as summarized by the model overlayed in red.</p>
<p><img src="img/ABRF_skyline_equalizeNorm_ProfilePlot_wSummarization_1.png" style="width:50.0%" /></p>
<p>Instead of making all profile plots for all proteins, we can make plot for individual protein.
Here is the example of spike-in protein, <code>sp|P44015|VAC2_YEAST</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.skyline, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P44015|VAC2_YEAST&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_Skyline/ABRF_skyline_equalizeNorm_P44015_&quot;</span>)</code></pre>
<p><img src="img/ABRF_skyline_equalizeNorm_P44015_ProfilePlot.png" style="width:50.0%" /></p>
<p><img src="img/ABRF_skyline_equalizeNorm_P44015_ProfilePlot_wSummarization.png" style="width:50.0%" /></p>
</div>
<div id="condition-plots" class="section level5">
<h5><span class="header-section-number">2.2.1.3.3</span> Condition plots</h5>
<p>Condition plots illustrate the systematic difference between conditions. The dots indicates the mean of all summarized intensities in each condition and default error bar is CI with 0.95 significant level. However, it is not related with model-based analysis.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.skyline, 
                 <span class="dt">type=</span><span class="st">&quot;conditionplot&quot;</span>, 
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_Skyline/ABRF_skyline_equalizeNorm_&quot;</span>)</code></pre>
<p>We can draw the condition plot for a protein, <code>sp|P44015|VAC2_YEAST</code> .</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.skyline, 
                 <span class="dt">type=</span><span class="st">&quot;conditionplot&quot;</span>, 
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P44015|VAC2_YEAST&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_Skyline/ABRF_skyline_equalizeNorm_P44015_&quot;</span>)</code></pre>
<p><img src="img/ABRF_skyline_equalizeNorm_ConditionPlot_P44015.png" style="width:50.0%" /></p>
<blockquote>
<p>Challenge</p>
<p>This is the study design. Let’s check visualization for other 5 spike-in proteins.
1. sp|P55752|ISCB_YEAST
2. sp|P44374|SFG2_YEAST
3. sp|P44983|UTR6_YEAST
4. sp|P44683|PGA4_YEAST
5. sp|P55249|ZRT4_YEAST</p>
</blockquote>
<div class="figure">
<img src="img/Protein_sample_information.png" alt="Experimental design for spike-in proteins" style="width:50.0%" />
<p class="caption">Experimental design for spike-in proteins</p>
</div>
<hr />
</div>
</div>
<div id="different-normalization-option" class="section level4">
<h4><span class="header-section-number">2.2.1.4</span> Different normalization option</h4>
<p>Let’s see the different normalization effect with SRM dataset including two proteins</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(SRMRawData)</code></pre>
<pre><code>##     ProteinName PeptideSequence PrecursorCharge FragmentIon ProductCharge
## 243        IDHC   ATDVIVPEEGELR               2          y7            NA
## 244        IDHC   ATDVIVPEEGELR               2          y7            NA
## 245        IDHC   ATDVIVPEEGELR               2          y8            NA
## 246        IDHC   ATDVIVPEEGELR               2          y8            NA
## 247        IDHC   ATDVIVPEEGELR               2          y9            NA
## 248        IDHC   ATDVIVPEEGELR               2          y9            NA
##     IsotopeLabelType Condition BioReplicate Run   Intensity
## 243                H         1        ReplA   1 84361.08350
## 244                L         1        ReplA   1   215.13526
## 245                H         1        ReplA   1 29778.10188
## 246                L         1        ReplA   1    98.02134
## 247                H         1        ReplA   1 17921.29255
## 248                L         1        ReplA   1    60.47029</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(SRMRawData<span class="op">$</span>ProteinName)</code></pre>
<pre><code>## [1] IDHC PMG2
## 45 Levels: ACEA ACH1 ACON ADH1 ADH2 ADH4 ALDH6 ALF CISY1 CISY2 ... SUCB</code></pre>
<div id="no-normalization" class="section level5">
<h5><span class="header-section-number">2.2.1.4.1</span> No normalization</h5>
<p>No normalization is performed. If you had your own normalization before <code>MSstats</code>, you should use like below.</p>
<pre class="sourceCode r"><code class="sourceCode r">srm.nonorm &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(SRMRawData, <span class="dt">normalization=</span><span class="ot">FALSE</span>)
<span class="kw">dataProcessPlots</span>(srm.nonorm, <span class="dt">type=</span><span class="st">&#39;QCplot&#39;</span>, <span class="dt">address=</span><span class="st">&#39;srm_noNorm_&#39;</span>)</code></pre>
<p><img src="img/srm_noNorm_QCPlot.png" style="width:50.0%" /></p>
</div>
<div id="equalize-medians-normalization" class="section level5">
<h5><span class="header-section-number">2.2.1.4.2</span> Equalize medians normalization</h5>
<p>The default option for normalization is ‘equalizeMedians’, where all the
intensities in a run are shifted by a constant, to equalize the median of intensities across runs for
label-free experiment. This normalization method is appropriate <strong>when we can assume that the
majority of proteins do not change across runs</strong>. Be cautious when using the <code>equalizeMedians</code>
option for a label-free DDA dataset with only a small number of proteins. For label based experiment,
<code>equalizeMedians</code> equalizes the median of reference intensities across runs and is generally proper
even for a dataset with a small number of proteins.</p>
<pre class="sourceCode r"><code class="sourceCode r">srm.equalmed &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(SRMRawData, <span class="dt">normalization =</span> <span class="st">&#39;equalizeMedians&#39;</span>)
<span class="kw">dataProcessPlots</span>(srm.equalmed, <span class="dt">type=</span><span class="st">&#39;QCplot&#39;</span>, <span class="dt">address=</span><span class="st">&#39;srm_equalM_&#39;</span>)</code></pre>
<p><img src="img/srm_equalM_QCPlot.png" style="width:50.0%" /></p>
</div>
<div id="quantile-normalization" class="section level5">
<h5><span class="header-section-number">2.2.1.4.3</span> Quantile normalization</h5>
<p>The distribution of all the intensities in each run will become the same across runs for
label-free experiment. For label-based experiment, the distribution of all the reference intensities
will be become the same across runs and all the endogenous intensities are shifted by a constant
corresponding to reference intensities.</p>
<pre class="sourceCode r"><code class="sourceCode r">srm.quantile &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(SRMRawData, <span class="dt">normalization=</span><span class="st">&#39;quantile&#39;</span>)
<span class="kw">dataProcessPlots</span>(srm.quantile, <span class="dt">type=</span><span class="st">&#39;QCplot&#39;</span>, <span class="dt">address=</span><span class="st">&#39;srm_quantile_&#39;</span>)</code></pre>
<p><img src="img/srm_quantile_QCPlot.png" style="width:50.0%" /></p>
</div>
<div id="global-standards-normalization-example-1" class="section level5">
<h5><span class="header-section-number">2.2.1.4.4</span> Global standards normalization : example 1</h5>
<p>If you have a spiked in standard across all MS runs, you may set this to <code>globalStandards</code> and define the standard with <code>nameStandards</code> option. Global standard peptide or Protein names, which you can assume that they have the same abundance across MS runs, should be assigned in the vector for this option.</p>
<p>First, let’s assume that <code>PMG2</code> proteins is the spike-in protein and shoule be equal amount across MS runs.</p>
<pre class="sourceCode r"><code class="sourceCode r">srm.global.pmg2 &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(SRMRawData, <span class="dt">normalization =</span><span class="st">&#39;globalStandards&#39;</span>,
                               <span class="dt">nameStandards =</span> <span class="st">&#39;PMG2&#39;</span>)
<span class="kw">dataProcessPlots</span>(srm.global.pmg2, <span class="dt">type=</span><span class="st">&#39;QCplot&#39;</span>, <span class="dt">address=</span><span class="st">&#39;srm_global_PMG2_&#39;</span>)</code></pre>
<p><img src="img/srm_global_PMG2_QCPlot.png" style="width:50.0%" /></p>
<p>Second, let’s assume that <code>IDHC</code> proteins is the spike-in protein and shoule be equal amount across MS runs.</p>
</div>
<div id="global-standards-normalization-example-2" class="section level5">
<h5><span class="header-section-number">2.2.1.4.5</span> Global standards normalization : example 2</h5>
<pre class="sourceCode r"><code class="sourceCode r">srm.global.idhc &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(SRMRawData, <span class="dt">normalization =</span><span class="st">&#39;globalStandards&#39;</span>,
                               <span class="dt">nameStandards =</span> <span class="st">&#39;IDHC&#39;</span>)
<span class="kw">dataProcessPlots</span>(srm.global.idhc, <span class="dt">type=</span><span class="st">&#39;QCplot&#39;</span>, <span class="dt">address=</span><span class="st">&#39;srm_global_IDHC_&#39;</span>)</code></pre>
<p><img src="img/srm_global_IDHC_QCPlot.png" style="width:50.0%" /></p>
</div>
</div>
<div id="different-summarization-option" class="section level4">
<h4><span class="header-section-number">2.2.1.5</span> Different summarization option</h4>
<p>Here is the summary of combinations for imputation options with summaryMethod=‘TMP’.</p>
<ul>
<li><p>MBimpute=TRUE : AFT model-based imputation using <code>cutoffCensored</code> value in the AFT model.</p></li>
<li><p>The default option for <code>cutoffCensored</code> is <code>minFeature</code>, taking the minimum value for the corresponding
feature. With this option, those runs with substantial missing measurements will be biased by
the cutoff value. In such case, you may remove the runs that have more than 50% missing values from the
analysis with the option remove50missing=TRUE.</p></li>
<li><p>In case that there are completely missing measurements in a run for a protein, any imputation
will not be performed.</p></li>
</ul>
<div id="no-imputation-tmp-summarization-only" class="section level5">
<h5><span class="header-section-number">2.2.1.5.1</span> No imputation, TMP summarization only</h5>
<pre class="sourceCode r"><code class="sourceCode r">quant.skyline.TMPonly &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.skyline, 
                                      <span class="dt">logTrans=</span><span class="dv">2</span>, 
                                      <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                                      <span class="dt">MBimpute=</span><span class="ot">FALSE</span>, <span class="co">##</span>
                                      <span class="dt">censoredInt=</span><span class="st">&#39;0&#39;</span>,
                                      <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                                      <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
<p>The column, <code>censored</code>, is not in the processed data any more.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(quant.skyline.TMPonly<span class="op">$</span>ProcessedData)</code></pre>
<pre><code>##                    PROTEIN                       PEPTIDE TRANSITION
## 27092 sp|D6VTK4|STE2_YEAST EGEVEPVDM[+16]YTPDTAADEEARK_3     sum_NA
## 10700 sp|D6VTK4|STE2_YEAST      EGEVEPVDMYTPDTAADEEARK_3     sum_NA
## 20407 sp|D6VTK4|STE2_YEAST         FYPGTLSSFQTDSINNDAK_2     sum_NA
## 2213  sp|D6VTK4|STE2_YEAST                  IGPFADASYK_2     sum_NA
## 938   sp|D6VTK4|STE2_YEAST                     KETTSDK_2     sum_NA
## 26116 sp|D6VTK4|STE2_YEAST               NQFYQLPTPTSSK_2     sum_NA
##                                    FEATURE LABEL GROUP_ORIGINAL
## 27092 EGEVEPVDM[+16]YTPDTAADEEARK_3_sum_NA     L     Condition1
## 10700      EGEVEPVDMYTPDTAADEEARK_3_sum_NA     L     Condition1
## 20407         FYPGTLSSFQTDSINNDAK_2_sum_NA     L     Condition1
## 2213                   IGPFADASYK_2_sum_NA     L     Condition1
## 938                       KETTSDK_2_sum_NA     L     Condition1
## 26116               NQFYQLPTPTSSK_2_sum_NA     L     Condition1
##       SUBJECT_ORIGINAL RUN GROUP SUBJECT SUBJECT_NESTED INTENSITY
## 27092                1   1     1       1            1.1   5222795
## 10700                1   1     1       1            1.1 182195648
## 20407                1   1     1       1            1.1  86229170
## 2213                 1   1     1       1            1.1 157996653
## 938                  1   1     1       1            1.1 177684007
## 26116                1   1     1       1            1.1 140368798
##       ABUNDANCE METHOD               originalRUN
## 27092  22.07353      1 JD_06232014_sample1_B.raw
## 10700  27.19805      1 JD_06232014_sample1_B.raw
## 20407  26.11881      1 JD_06232014_sample1_B.raw
## 2213   26.99246      1 JD_06232014_sample1_B.raw
## 938    27.16188      1 JD_06232014_sample1_B.raw
## 26116  26.82179      1 JD_06232014_sample1_B.raw</code></pre>
<hr />
</div>
</div>
</div>
<div id="dataprocess-with-maxquant-data" class="section level3">
<h3><span class="header-section-number">2.2.2</span> dataProcess with MaxQuant data</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_MaxQuant/input.maxquant.rda&#39;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.maxquant)</code></pre>
<pre><code>##   ProteinName        PeptideSequence PrecursorCharge FragmentIon
## 1      D6VTK4 EGEVEPVDMYTPDTAADEEARK               3          NA
## 2      D6VTK4    FYPGTLSSFQTDSINNDAK               2          NA
## 3      D6VTK4             IGPFADASYK               2          NA
## 4      D6VTK4          NQFYQLPTPTSSK               2          NA
## 5      D6VTK4           TFVSETADDIEK               2          NA
## 6      D6VTK4         TNTITSDFTTSTDR               2          NA
##   ProductCharge IsotopeLabelType  Condition BioReplicate
## 1            NA                L Condition1            1
## 2            NA                L Condition1            1
## 3            NA                L Condition1            1
## 4            NA                L Condition1            1
## 5            NA                L Condition1            1
## 6            NA                L Condition1            1
##                     Run Intensity
## 1 JD_06232014_sample1_B  87141000
## 2 JD_06232014_sample1_B  46167000
## 3 JD_06232014_sample1_B  45425000
## 4 JD_06232014_sample1_B  47094000
## 5 JD_06232014_sample1_B        NA
## 6 JD_06232014_sample1_B  62786000</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.maxquant<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 40056</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.maxquant<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.maxquant<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 0</code></pre>
<p><strong>Note!</strong> MaxQuant output has only <code>NA</code>. <strong>censoredInt=‘NA’</strong> should be used for MaxQuant output.</p>
<blockquote>
<p>Challenges</p>
<ol style="list-style-type: decimal">
<li>Try <code>dataProcess</code> with equalize median normalization for MaxQuant output. (<code>input.maxquant.rda</code> from section 1)</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r">quant.maxquant &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.maxquant, 
                                      <span class="dt">logTrans=</span><span class="dv">2</span>, 
                                      <span class="co">#normalization = &#39;quantile&#39;,</span>
                                      <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                                      <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                                      <span class="dt">censoredInt=</span><span class="st">&#39;NA&#39;</span>,
                                      <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                                      <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
</details>
<blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Try <code>dataProcess</code> with quantile normalization for MaxQuant output. (<code>input.maxquant.rda</code> from section 1)</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r">quant.maxquant.quantile &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.maxquant, 
                              <span class="dt">logTrans=</span><span class="dv">2</span>, 
                              <span class="dt">normalization =</span> <span class="st">&#39;quantile&#39;</span>,
                              <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                              <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                              <span class="dt">censoredInt=</span><span class="st">&#39;NA&#39;</span>,
                              <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                              <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
</details>
<blockquote>
<ol start="3" style="list-style-type: decimal">
<li>Draw QC plots for both cases above and compare.</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.maxquant, 
                 <span class="dt">type=</span><span class="st">&quot;QCplot&quot;</span>, 
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;allonly&#39;</span>,
                 <span class="dt">address=</span><span class="st">&#39;data/data_MaxQuant/ABRF_maxquant_equalMed_&#39;</span>)

<span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.maxquant.quantile, 
                 <span class="dt">type=</span><span class="st">&quot;QCplot&quot;</span>, 
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;allonly&#39;</span>,
                 <span class="dt">address=</span><span class="st">&#39;data/data_MaxQuant/ABRF_maxquant_quantile_&#39;</span>)</code></pre>
</details>
<blockquote>
<ol start="4" style="list-style-type: decimal">
<li>Draw Profile plots of protein <code>P55249</code>, for both cases above and compare.</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.maxquant, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;P55249&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_MaxQuant/ABRF_maxquant_equalMed_P55249_&quot;</span>)

<span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.maxquant.quantile, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;P55249&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_MaxQuant/ABRF_maxquant_quantile_P55249_&quot;</span>)</code></pre>
</details>
<hr />
</div>
<div id="dataprocess-with-openms-data" class="section level3">
<h3><span class="header-section-number">2.2.3</span> dataProcess with OpenMS data</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_OpenMS/input.openms.rda&#39;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.openms)</code></pre>
<pre><code>##            ProteinName        PeptideSequence PrecursorCharge FragmentIon
## 1 sp|D6VTK4|STE2_YEAST EGEVEPVDMYTPDTAADEEARK               3          NA
## 2 sp|D6VTK4|STE2_YEAST    FYPGTLSSFQTDSINNDAK               2          NA
## 3 sp|D6VTK4|STE2_YEAST             IGPFADASYK               2          NA
## 4 sp|D6VTK4|STE2_YEAST          NQFYQLPTPTSSK               2          NA
## 5 sp|D6VTK4|STE2_YEAST           TFVSETADDIEK               2          NA
## 6 sp|D6VTK4|STE2_YEAST         TNTITSDFTTSTDR               2          NA
##   ProductCharge IsotopeLabelType Condition BioReplicate Run Intensity
## 1             0                L         1            1   1  64757900
## 2             0                L         1            1   1  38852700
## 3             0                L         1            1   1  73225800
## 4             0                L         1            1   1  63139900
## 5             0                L         1            1   1        NA
## 6             0                L         1            1   1  58905300</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.openms<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 21962</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.openms<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.openms<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 0</code></pre>
<p><strong>Note!</strong> OpenMS output has only <code>NA</code>. <strong>censoredInt=‘NA’</strong> should be used for OpenMS output.</p>
<blockquote>
<p>Challenges</p>
<ol style="list-style-type: decimal">
<li>Try <code>dataProcess</code> with equalize normalization for OpenMS output. (<code>input.openms.rda</code> from section 1)</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r">quant.openms &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.openms, 
                              <span class="dt">logTrans=</span><span class="dv">2</span>, 
                              <span class="co">#normalization = &#39;quantile&#39;,</span>
                              <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                              <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                              <span class="dt">censoredInt=</span><span class="st">&#39;NA&#39;</span>,
                              <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                              <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
</details>
<blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Try <code>dataProcess</code> with quantile normalization for OpenMS output. (<code>input.openms.rda</code> from section 1)</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r">quant.openms.quantile &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.openms, 
                                       <span class="dt">logTrans=</span><span class="dv">2</span>, 
                                       <span class="dt">normalization =</span> <span class="st">&#39;quantile&#39;</span>,
                                       <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                                       <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                                       <span class="dt">censoredInt=</span><span class="st">&#39;NA&#39;</span>,
                                       <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                                       <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
</details>
<blockquote>
<ol start="3" style="list-style-type: decimal">
<li>Draw Profile plots of protein <code>sp|P55249|ZRT4_YEAST</code>, for both cases above and compare.</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.openms, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P55249|ZRT4_YEAST&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_OpenMS/ABRF_openms_equalMed_P55249_&quot;</span>)

<span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.openms.quantile, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P55249|ZRT4_YEAST&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_OpenMS/ABRF_openms_quantile_P55249_&quot;</span>)</code></pre>
</details>
<hr />
</div>
<div id="dataprocess-with-progenesis-data" class="section level3">
<h3><span class="header-section-number">2.2.4</span> dataProcess with Progenesis data</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_Progenesis/input.progenesis.rda&#39;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.progenesis)</code></pre>
<pre><code>##             ProteinName       PeptideModifiedSequence PrecursorCharge
## 1 sp|A5Z2X5|YP010_YEAST              LTGNPELSSLDEVLAK               2
## 2 sp|A5Z2X5|YP010_YEAST RPAQLLL[N-term] nTerm+42.0106               2
## 3  sp|D6VTK4|STE2_YEAST        EGEVEPVDMYTPDTAADEEARK               3
## 4  sp|D6VTK4|STE2_YEAST           FYPGTLSSFQTDSINNDAK               2
## 5  sp|D6VTK4|STE2_YEAST                    IGPFADASYK               2
## 6  sp|O13297|CET1_YEAST                   IAGNAVGSVVK               2
##   FragmentIon ProductCharge IsotopeLabelType  Condition BioReplicate
## 1          NA            NA                L Condition1            1
## 2          NA            NA                L Condition1            1
## 3          NA            NA                L Condition1            1
## 4          NA            NA                L Condition1            1
## 5          NA            NA                L Condition1            1
## 6          NA            NA                L Condition1            1
##                     Run Intensity
## 1 JD_06232014_sample1_B 2550357.3
## 2 JD_06232014_sample1_B  865491.8
## 3 JD_06232014_sample1_B 3767734.3
## 4 JD_06232014_sample1_B 2591735.2
## 5 JD_06232014_sample1_B 2301483.1
## 6 JD_06232014_sample1_B  415181.8</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(input.progenesis<span class="op">$</span>Intensity)) </code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(input.progenesis<span class="op">$</span>Intensity) <span class="op">&amp;</span><span class="st"> </span>input.progenesis<span class="op">$</span>Intensity<span class="op">==</span><span class="dv">0</span>)</code></pre>
<pre><code>## [1] 418</code></pre>
<p><strong>Note!</strong> Progenesis output has only <code>0</code>. <strong>censoredInt=‘0’</strong> should be used for Progenesis output.</p>
<blockquote>
<p>Challenges</p>
<ol style="list-style-type: decimal">
<li>Try <code>dataProcess</code> with equalize normalization for Progenesis output. (<code>input.progenesis.rda</code> from section 1)</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r">quant.progenesis &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.progenesis, 
                              <span class="dt">logTrans=</span><span class="dv">2</span>, 
                              <span class="co">#normalization = &#39;quantile&#39;,</span>
                              <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                              <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                              <span class="dt">censoredInt=</span><span class="st">&#39;0&#39;</span>,
                              <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                              <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
</details>
<blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Try <code>dataProcess</code> with quantile normalization for Progenesis output. (<code>input.progenesis.rda</code> from section 1)</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r">quant.progenesis.quantile &lt;-<span class="st"> </span><span class="kw">dataProcess</span>(<span class="dt">raw =</span> input.progenesis, 
                                       <span class="dt">logTrans=</span><span class="dv">2</span>, 
                                       <span class="dt">normalization =</span> <span class="st">&#39;quantile&#39;</span>,
                                       <span class="dt">summaryMethod =</span> <span class="st">&#39;TMP&#39;</span>, 
                                       <span class="dt">MBimpute=</span><span class="ot">TRUE</span>,
                                       <span class="dt">censoredInt=</span><span class="st">&#39;0&#39;</span>,
                                       <span class="dt">cutoffCensored=</span><span class="st">&#39;minFeature&#39;</span>,
                                       <span class="dt">maxQuantileforCensored =</span> <span class="fl">0.999</span>)</code></pre>
</details>
<blockquote>
<ol start="3" style="list-style-type: decimal">
<li>Draw Profile plots of protein <code>sp|P55249|ZRT4_YEAST</code>, for both cases above and compare.</li>
</ol>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.progenesis, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P55249|ZRT4_YEAST&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_Progenesis/ABRF_progenesis_equalMed_P55249_&quot;</span>)

<span class="kw">dataProcessPlots</span>(<span class="dt">data =</span> quant.progenesis.quantile, 
                 <span class="dt">type=</span><span class="st">&quot;Profileplot&quot;</span>, 
                 <span class="dt">featureName=</span><span class="st">&quot;NA&quot;</span>,
                 <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">7</span>,
                 <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P55249|ZRT4_YEAST&#39;</span>,
                 <span class="dt">address=</span><span class="st">&quot;data/data_Progenesis/ABRF_progenesis_quantile_P55249_&quot;</span>)</code></pre>
</details>
<blockquote>
<ol start="4" style="list-style-type: decimal">
<li>Compare profile plots from MaxQuant data.</li>
</ol>
</blockquote>
<hr />
</div>
</div>
<div id="differential-abundance-and-sample-size-calculation" class="section level2">
<h2><span class="header-section-number">2.3</span> Differential abundance and sample size calculation</h2>
<div id="inference-and-future-design-of-experiment-with-skyline-output" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Inference and future design of experiment with Skyline output</h3>
<div id="load-the-processed-data-output-of-dataprocess-of-skyline-output" class="section level4">
<h4><span class="header-section-number">2.3.1.1</span> Load the processed data (output of <code>dataProcess</code>) of Skyline output</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_Skyline/quant.skyline.rda&#39;</span>)</code></pre>
<hr />
</div>
<div id="finding-differentially-abundant-proteins-across-conditions" class="section level4">
<h4><span class="header-section-number">2.3.1.2</span> Finding differentially abundant proteins across conditions</h4>
<p><img src="img/MSstats_groupComparison.png" style="width:90.0%" /></p>
<div id="assign-contrast-matrix" class="section level5">
<h5><span class="header-section-number">2.3.1.2.1</span> Assign contrast matrix</h5>
<p>After we normalized the data and summarized each protein’s behaviour across conditions in <code>dataProcess</code> step, we are all set to compare protein changes between groups of conditions. Within MSstats we can do this with the <code>groupComparison</code> function, which takes as input the output of the <code>dataProcess</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r">?groupComparison</code></pre>
<p>We have to tell <code>groupComparison</code> which are the conditions we would like to compare.
You can make your <code>contrast.matrix</code> in R in a text editor. We define our contrast matrix by adding a column for every condition, <strong>in alphabetical order</strong>. We add a row for every comparison we would like to make between groups of conditions.</p>
<p><strong>0</strong> is for conditions we would like to ignore.
<strong>1</strong> is for conditions we would like to put in the numerator of the ratio or fold-change.
<strong>-1</strong> is for conditions we would like to put in the denumerator of the ratio or fold-change.</p>
<p>If you have multiple groups, you can assign any gruop comparisons you are interested in. For example, if you have 4 different conditions, Condition1, Condition2, Condition3, Condition4, there are many possible comparisons.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check unique conditions and check order of condition information</span>
<span class="co"># In this case, Disease and Healthy</span>
<span class="kw">unique</span>(quant.skyline<span class="op">$</span>ProcessedData<span class="op">$</span>GROUP_ORIGINAL)</code></pre>
<pre><code>## [1] Condition1 Condition2 Condition3 Condition4
## Levels: Condition1 Condition2 Condition3 Condition4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">comparison1&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison2&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison&lt;-<span class="kw">rbind</span>(comparison1, comparison2)
<span class="kw">row.names</span>(comparison)&lt;-<span class="kw">c</span>(<span class="st">&quot;C2-C1&quot;</span>,<span class="st">&quot;C3-C1&quot;</span>)

comparison</code></pre>
<pre><code>##       [,1] [,2] [,3] [,4]
## C2-C1   -1    1    0    0
## C3-C1   -1    0    1    0</code></pre>
<blockquote>
<p>Challenges</p>
<p>Make the matrix, named <code>comparison</code>, for all 6 paired comparision among 4 conditions (condition1, condition2, condition3, condition4)</p>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(quant.skyline<span class="op">$</span>ProcessedData<span class="op">$</span>GROUP_ORIGINAL)</code></pre>
<pre><code>## [1] Condition1 Condition2 Condition3 Condition4
## Levels: Condition1 Condition2 Condition3 Condition4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">comparison1&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison2&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison3&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison4&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison5&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison6&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">nrow=</span><span class="dv">1</span>)
comparison&lt;-<span class="kw">rbind</span>(comparison1, comparison2, comparison3, comparison4, comparison5, comparison6)
<span class="kw">row.names</span>(comparison)&lt;-<span class="kw">c</span>(<span class="st">&quot;C2-C1&quot;</span>,<span class="st">&quot;C3-C1&quot;</span>,<span class="st">&quot;C4-C1&quot;</span>,<span class="st">&quot;C3-C2&quot;</span>,<span class="st">&quot;C4-C2&quot;</span>,<span class="st">&quot;C4-C3&quot;</span>)

comparison</code></pre>
<pre><code>##       [,1] [,2] [,3] [,4]
## C2-C1   -1    1    0    0
## C3-C1   -1    0    1    0
## C4-C1   -1    0    0    1
## C3-C2    0   -1    1    0
## C4-C2    0   -1    0    1
## C4-C3    0    0   -1    1</code></pre>
</details>
</div>
<div id="comparing-conditions-with-groupcomparison" class="section level5">
<h5><span class="header-section-number">2.3.1.2.2</span> Comparing conditions with <code>groupComparison</code></h5>
<p><code>groupComparison</code> uses the run-level summarized data (<code>$RunlevelData</code> from <code>dataProcess</code> function) for hypothesis testing.</p>
<pre class="sourceCode r"><code class="sourceCode r">test.skyline &lt;-<span class="st"> </span><span class="kw">groupComparison</span>(<span class="dt">contrast.matrix=</span>comparison, <span class="dt">data=</span>quant.skyline)</code></pre>
<p>Let’s check the output.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(test.skyline)</code></pre>
<pre><code>## [1] &quot;list&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(test.skyline)</code></pre>
<pre><code>## [1] &quot;ComparisonResult&quot; &quot;ModelQC&quot;          &quot;fittedmodel&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Show test result</span>
<span class="co"># Label : which comparison is used</span>
<span class="co"># log2FC : estimated log2 fold change between Diseased and Healthy</span>
<span class="co"># adj.pvalue : adjusted p value</span>
<span class="co"># issue : detect whether this protein has any issue for comparison</span>
<span class="co">#    such as, there is measurement in certain group, or no measurement at all.</span>
<span class="co"># MissingPercentage : the number of missing intensities/total number of intensities </span>
<span class="co">#     in conditions your are interested in for comparison</span>
<span class="co"># ImputationPercentage : the number of imputed intensities/total number of intensities </span>
<span class="co">#     in conditions your are interested in for comparison</span>
<span class="kw">head</span>(test.skyline<span class="op">$</span>ComparisonResult)</code></pre>
<pre><code>##                 Protein Label      log2FC         SE     Tvalue DF
## 1  sp|D6VTK4|STE2_YEAST C2-C1  0.06094263 0.10304517  0.5914167  8
## 2  sp|O13297|CET1_YEAST C2-C1 -0.11024579 0.07589698 -1.4525714  8
## 3  sp|O13329|FOB1_YEAST C2-C1 -0.16114268 0.29273717 -0.5504688  8
## 4  sp|O13539|THP2_YEAST C2-C1 -0.43646953 0.83013182 -0.5257834  8
## 5 sp|O13547|CCW14_YEAST C2-C1 -0.05679619 0.14506388 -0.3915254  8
## 6 sp|O13563|RPN13_YEAST C2-C1 -0.16850033 0.09496183 -1.7744006  8
##      pvalue adj.pvalue issue MissingPercentage ImputationPercentage
## 1 0.5705706  0.9983122    NA                 0                    0
## 2 0.1844096  0.9983122    NA                 0                    0
## 3 0.5970289  0.9983122    NA                 0                    0
## 4 0.6132973  0.9983122    NA                 0                    0
## 5 0.7056311  0.9983122    NA                 0                    0
## 6 0.1139193  0.9983122    NA                 0                    0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># After fitting linear model, residuals and fitted values can be shown.</span>
<span class="kw">head</span>(test.skyline<span class="op">$</span>ModelQC)</code></pre>
<pre><code>##    RUN              PROTEIN ABUNDANCE NumMeasuredFeature MissingPercentage
## 1:   1 sp|D6VTK4|STE2_YEAST  26.95958                  7                 0
## 2:   2 sp|D6VTK4|STE2_YEAST  26.78088                  7                 0
## 3:   3 sp|D6VTK4|STE2_YEAST  26.68074                  7                 0
## 4:   4 sp|D6VTK4|STE2_YEAST  26.98540                  7                 0
## 5:   5 sp|D6VTK4|STE2_YEAST  26.90384                  7                 0
## 6:   6 sp|D6VTK4|STE2_YEAST  26.71479                  7                 0
##    more50missing NumImputedFeature               originalRUN GROUP
## 1:         FALSE                 0 JD_06232014_sample1_B.raw     1
## 2:         FALSE                 0 JD_06232014_sample1_C.raw     1
## 3:         FALSE                 0 JD_06232014_sample1-A.raw     1
## 4:         FALSE                 0 JD_06232014_sample2_A.raw     2
## 5:         FALSE                 0 JD_06232014_sample2_B.raw     2
## 6:         FALSE                 0 JD_06232014_sample2_C.raw     2
##    GROUP_ORIGINAL SUBJECT_ORIGINAL SUBJECT_NESTED SUBJECT   residuals
## 1:     Condition1                1            1.1       1  0.15251179
## 2:     Condition1                1            1.1       1 -0.02618545
## 3:     Condition1                1            1.1       1 -0.12632634
## 4:     Condition2                2            2.4       4  0.11739159
## 5:     Condition2                2            2.4       4  0.03582686
## 6:     Condition2                2            2.4       4 -0.15321844
##      fitted
## 1: 26.80707
## 2: 26.80707
## 3: 26.80707
## 4: 26.86801
## 5: 26.86801
## 6: 26.86801</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fitted model per protein</span>
<span class="kw">head</span>(test.skyline<span class="op">$</span>fittedmodel)</code></pre>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##    26.80707      0.06094     -0.16303     -0.11015  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##    24.69673     -0.11025     -0.13596     -0.08799  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##     23.6136      -0.1611       0.1294      -0.3427  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##     26.3935      -0.4365      -0.4232      -0.4941  
## 
## 
## [[5]]
## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##    27.04062     -0.05680     -0.28259     -0.08648  
## 
## 
## [[6]]
## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##    26.17882     -0.16850     -0.06754     -0.20791</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">test.skyline<span class="op">$</span>fittedmodel[[<span class="dv">1</span>]]</code></pre>
<pre><code>## 
## Call:
## lm(formula = ABUNDANCE ~ GROUP, data = data2)
## 
## Coefficients:
## (Intercept)       GROUP2       GROUP3       GROUP4  
##    26.80707      0.06094     -0.16303     -0.11015</code></pre>
</div>
<div id="save-the-comparison-result" class="section level5">
<h5><span class="header-section-number">2.3.1.2.3</span> Save the comparison result</h5>
<p>Let’s save the testing result as rdata and .csv file.</p>
<pre class="sourceCode r"><code class="sourceCode r">Skyline.result &lt;-<span class="st"> </span>test.skyline<span class="op">$</span>ComparisonResult

<span class="kw">save</span>(Skyline.result, <span class="dt">file=</span><span class="st">&#39;data/data_Skyline/Skyline.result.rda&#39;</span>)
<span class="kw">write.csv</span>(Skyline.result, <span class="dt">file=</span><span class="st">&#39;data/data_Skyline/testResult_ABRF_skyline.csv&#39;</span>)</code></pre>
</div>
<div id="subset-of-significant-comparisons" class="section level5">
<h5><span class="header-section-number">2.3.1.2.4</span> subset of significant comparisons</h5>
<p>Let’s inspect the results to see what proteins are changing significantly between Diseased and Healthy.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(Skyline.result)</code></pre>
<pre><code>##                 Protein Label      log2FC         SE     Tvalue DF
## 1  sp|D6VTK4|STE2_YEAST C2-C1  0.06094263 0.10304517  0.5914167  8
## 2  sp|O13297|CET1_YEAST C2-C1 -0.11024579 0.07589698 -1.4525714  8
## 3  sp|O13329|FOB1_YEAST C2-C1 -0.16114268 0.29273717 -0.5504688  8
## 4  sp|O13539|THP2_YEAST C2-C1 -0.43646953 0.83013182 -0.5257834  8
## 5 sp|O13547|CCW14_YEAST C2-C1 -0.05679619 0.14506388 -0.3915254  8
## 6 sp|O13563|RPN13_YEAST C2-C1 -0.16850033 0.09496183 -1.7744006  8
##      pvalue adj.pvalue issue MissingPercentage ImputationPercentage
## 1 0.5705706  0.9983122    NA                 0                    0
## 2 0.1844096  0.9983122    NA                 0                    0
## 3 0.5970289  0.9983122    NA                 0                    0
## 4 0.6132973  0.9983122    NA                 0                    0
## 5 0.7056311  0.9983122    NA                 0                    0
## 6 0.1139193  0.9983122    NA                 0                    0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># select subset of rows with adj.pvalue &lt; 0.05</span>
SignificantProteins &lt;-<span class="st"> </span>
<span class="st">  </span>Skyline.result[Skyline.result<span class="op">$</span>adj.pvalue <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>, ]

<span class="kw">nrow</span>(SignificantProteins)</code></pre>
<pre><code>## [1] 28</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># select subset of rows with adj.pvalue &lt; 0.05 and log2FC &gt; 2</span>
SignificantProteinsUpInDiseased &lt;-<span class="st"> </span>SignificantProteins[SignificantProteins<span class="op">$</span>log2FC <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span> ,]

<span class="kw">nrow</span>(SignificantProteinsUpInDiseased)</code></pre>
<pre><code>## [1] 14</code></pre>
<hr />
</div>
</div>
<div id="visualization-of-differentially-abundant-proteins" class="section level4">
<h4><span class="header-section-number">2.3.1.3</span> Visualization of differentially abundant proteins</h4>
<pre class="sourceCode r"><code class="sourceCode r">?groupComparisonPlots</code></pre>
<div id="volcano-plot" class="section level5">
<h5><span class="header-section-number">2.3.1.3.1</span> Volcano plot</h5>
<p>Volcano plots allow us to visually separate strong changes, which are not significant, from strong and significant changes. Look for these subjects in the upper right and upper left quadrants of the plot. Protein name will be shown only for siginificant proteins.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">groupComparisonPlots</span>(<span class="dt">data =</span> Skyline.result, 
                     <span class="dt">type =</span> <span class="st">&#39;VolcanoPlot&#39;</span>,
                     <span class="dt">address =</span> <span class="st">&#39;data/data_Skyline/testResult_ABRF_skyline_&#39;</span>)</code></pre>
<p><img src="img/ABRF_skyline_VolcanoPlot_1.png" style="width:60.0%" /></p>
<p>We can set up estimated fold change cutoff.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">groupComparisonPlots</span>(<span class="dt">data =</span> Skyline.result, 
                     <span class="dt">type =</span> <span class="st">&#39;VolcanoPlot&#39;</span>,
                     <span class="dt">sig =</span> <span class="fl">0.05</span>, 
                     <span class="dt">FCcutoff =</span> <span class="dv">2</span><span class="op">^</span><span class="dv">2</span>, 
                     <span class="dt">address =</span> <span class="st">&#39;data/data_Skyline/testResult_ABRF_skyline_FCcutoff4_&#39;</span>)</code></pre>
<p><img src="img/ABRF_skyline_FCcutoff4_VolcanoPlot_1.png" style="width:60.0%" /></p>
</div>
<div id="comparison-plot" class="section level5">
<h5><span class="header-section-number">2.3.1.3.2</span> Comparison plot</h5>
<p>Comparison plots illustrate model-based estimates of log-fold changes, and the associated
uncertainty, in several comparisons of conditions for one protein. X-axis is the comparison of
interest. Y-axis is the log fold change. The dots are the model-based estimates of log-fold
change, and the error bars are the model-based 95% confidence intervals (the option sig can
be used to change the significance level of significance). For simplicity, the confidence intervals
are adjusted for multiple comparisons within protein only, using the Bonferroni approach. For
proteins with N comparisons, the individual confidence intervals are at the level of 1-sig/N.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">groupComparisonPlots</span>(Skyline.result, 
                     <span class="dt">type=</span><span class="st">&quot;ComparisonPlot&quot;</span>, 
                     <span class="dt">address=</span><span class="st">&quot;data/data_Skyline/testResult_ABRF_skyline_&quot;</span>)</code></pre>
<p><img src="img/testResult_ABRF_skyline_ComparisonPlot_P44015.png" style="width:60.0%" /></p>
<p>Let’s check the comparison result for protein <code>sp|P44015|VAC2_YEAST</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">Skyline.result[Skyline.result<span class="op">$</span>Protein <span class="op">==</span><span class="st"> &#39;sp|P44015|VAC2_YEAST&#39;</span>, ]</code></pre>
<pre><code>##                    Protein Label     log2FC        SE      Tvalue DF
## 1756  sp|P44015|VAC2_YEAST C2-C1 -0.2287384 0.3108677  -0.7358063  8
## 4774  sp|P44015|VAC2_YEAST C3-C1 -2.9716852 0.3108677  -9.5593254  8
## 7792  sp|P44015|VAC2_YEAST C4-C1 -5.2574901 0.3108677 -16.9123090  8
## 10810 sp|P44015|VAC2_YEAST C3-C2 -2.7429468 0.3108677  -8.8235190  8
## 13828 sp|P44015|VAC2_YEAST C4-C2 -5.0287517 0.3108677 -16.1765027  8
## 16846 sp|P44015|VAC2_YEAST C4-C3 -2.2858049 0.3108677  -7.3529837  8
##             pvalue   adj.pvalue issue MissingPercentage
## 1756  4.828617e-01 0.9983122047    NA                 0
## 4774  1.187124e-05 0.0089568526    NA                 0
## 7792  1.515151e-07 0.0001143182    NA                 0
## 10810 2.143047e-05 0.0129354325    NA                 0
## 13828 2.143125e-07 0.0001293590    NA                 0
## 16846 7.970992e-05 0.0601411333    NA                 0
##       ImputationPercentage
## 1756                     0
## 4774                     0
## 7792                     0
## 10810                    0
## 13828                    0
## 16846                    0</code></pre>
<hr />
</div>
</div>
<div id="planning-future-experimental-designs" class="section level4">
<h4><span class="header-section-number">2.3.1.4</span> Planning future experimental designs</h4>
<p><img src="img/MSstats_workflow_design.png" style="width:90.0%" /></p>
<p>This last analysis step views the dataset as a pilot study of a future experiment, utilizes its variance components, and calculates the minimal number of replicates required in a future
experiment to achieve the desired statistical power. The calculation is performed by the function <code>designSampleSize</code>, which takes as input the fitted model in <code>groupComparison</code>. Sample size calculation assumes same experimental design (i.e. group comparison, time course or paired design) as in the current dataset, and uses the model fit to estimate the median variance components across all the proteins. Finally, sample size calculation assumes that a large proportion of proteins (specifically, 99%) will not change in abundance in the future experiment. This assumption also provides conservative results.
Using the estimated variance components, the function relates the number of biological replicates per condition (<code>numSample</code>, rounded to 0 decimal), average statistical power across all the proteins (<code>power</code>), minimal fold change that we would like to detect (can be specified as a range, e.g. <code>desiredFC=c(1.1, 2)</code>), and the False Discovery Rate (<code>FDR</code>). The user should specify all these quantities but one, and the function will solve for the remainder. The quantity to solve for should be set to <code>= TRUE</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">?designSampleSize</code></pre>
<div id="calculating-statistical-power" class="section level5">
<h5><span class="header-section-number">2.3.1.4.1</span> Calculating statistical power</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the power</span>
test.power &lt;-<span class="st"> </span><span class="kw">designSampleSize</span>(<span class="dt">data =</span> test.skyline<span class="op">$</span>fittedmodel, 
                               <span class="dt">desiredFC =</span> <span class="kw">c</span>(<span class="fl">1.1</span>, <span class="fl">1.6</span>), 
                               <span class="dt">FDR =</span> <span class="fl">0.05</span>,
                               <span class="dt">power =</span> <span class="ot">TRUE</span>,
                               <span class="dt">numSample =</span> <span class="dv">3</span>)
test.power</code></pre>
<pre><code>##    desiredFC numSample  FDR power    CV
## 1      1.100         3 0.05  0.01 0.010
## 2      1.125         3 0.05  0.01 0.010
## 3      1.150         3 0.05  0.01 0.010
## 4      1.175         3 0.05  0.01 0.010
## 5      1.200         3 0.05  0.04 0.009
## 6      1.225         3 0.05  0.10 0.009
## 7      1.250         3 0.05  0.20 0.009
## 8      1.275         3 0.05  0.33 0.009
## 9      1.300         3 0.05  0.47 0.009
## 10     1.325         3 0.05  0.59 0.008
## 11     1.350         3 0.05  0.70 0.008
## 12     1.375         3 0.05  0.79 0.008
## 13     1.400         3 0.05  0.86 0.008
## 14     1.425         3 0.05  0.91 0.008
## 15     1.450         3 0.05  0.94 0.008
## 16     1.475         3 0.05  0.97 0.008
## 17     1.500         3 0.05  0.98 0.007
## 18     1.525         3 0.05  0.99 0.007
## 19     1.550         3 0.05  0.99 0.007
## 20     1.575         3 0.05  0.99 0.007
## 21     1.600         3 0.05  0.99 0.007</code></pre>
</div>
<div id="visualizing-the-relationship-between-desired-fold-change-and-power" class="section level5">
<h5><span class="header-section-number">2.3.1.4.2</span> Visualizing the relationship between desired fold-change and power</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">designSampleSizePlots</span>(<span class="dt">data =</span> test.power)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
</div>
<div id="designing-sample-size-for-desired-fold-change" class="section level5">
<h5><span class="header-section-number">2.3.1.4.3</span> Designing sample size for desired fold-change</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Minimal number of biological replicates per condition</span>
samplesize &lt;-<span class="st"> </span><span class="kw">designSampleSize</span>(<span class="dt">data =</span> test.skyline<span class="op">$</span>fittedmodel, 
                               <span class="dt">desiredFC =</span> <span class="kw">c</span>(<span class="fl">1.1</span>, <span class="fl">1.6</span>), 
                               <span class="dt">FDR =</span> <span class="fl">0.05</span>,
                               <span class="dt">power =</span> <span class="fl">0.9</span>,
                               <span class="dt">numSample =</span> <span class="ot">TRUE</span>)
samplesize</code></pre>
<pre><code>##    desiredFC numSample  FDR power    CV
## 1      1.100        40 0.05   0.9 0.001
## 2      1.125        26 0.05   0.9 0.001
## 3      1.150        19 0.05   0.9 0.002
## 4      1.175        14 0.05   0.9 0.002
## 5      1.200        11 0.05   0.9 0.003
## 6      1.225         9 0.05   0.9 0.003
## 7      1.250         7 0.05   0.9 0.004
## 8      1.275         6 0.05   0.9 0.004
## 9      1.300         5 0.05   0.9 0.005
## 10     1.325         5 0.05   0.9 0.005
## 11     1.350         4 0.05   0.9 0.006
## 12     1.375         4 0.05   0.9 0.006
## 13     1.400         3 0.05   0.9 0.008
## 14     1.425         3 0.05   0.9 0.008
## 15     1.450         3 0.05   0.9 0.008
## 16     1.475         2 0.05   0.9 0.011
## 17     1.500         2 0.05   0.9 0.011
## 18     1.525         2 0.05   0.9 0.011
## 19     1.550         2 0.05   0.9 0.011
## 20     1.575         2 0.05   0.9 0.011
## 21     1.600         2 0.05   0.9 0.010</code></pre>
</div>
<div id="visualizing-the-relationship-between-desired-fold-change-and-mininum-sample-size-number" class="section level5">
<h5><span class="header-section-number">2.3.1.4.4</span> Visualizing the relationship between desired fold-change and mininum sample size number</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">designSampleSizePlots</span>(<span class="dt">data =</span> samplesize)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="protein-subject-quantification" class="section level4">
<h4><span class="header-section-number">2.3.1.5</span> Protein subject quantification</h4>
<p><img src="img/MSstats_workflow_quantification.png" style="width:90.0%" /></p>
<p>If there is no technical replicate, subject (or sample) quantification should be the same as run-level summarization. If there are technical replicates, subjet-level summarization(quantification) with run-level summarization will be useful for downstream analysis, such as classification.</p>
<pre class="sourceCode r"><code class="sourceCode r">?quantification</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">sampleQuant &lt;-<span class="st"> </span><span class="kw">quantification</span>(quant.skyline)
<span class="kw">head</span>(sampleQuant)</code></pre>
<pre><code>##                 Protein Condition1_1 Condition2_2 Condition3_3
## 1  sp|D6VTK4|STE2_YEAST     26.60824     26.79392     26.53057
## 2  sp|O13297|CET1_YEAST     24.71754     24.57784     24.62606
## 3  sp|O13329|FOB1_YEAST     23.47021     23.43389     23.73769
## 4  sp|O13539|THP2_YEAST     27.38549     25.90566     25.91828
## 5 sp|O13547|CCW14_YEAST     27.11584     26.91263     26.75494
## 6 sp|O13563|RPN13_YEAST     26.17001     26.00997     26.11441
##   Condition4_4
## 1     26.60602
## 2     24.64876
## 3     23.16636
## 4     25.91791
## 5     26.98071
## 6     26.05425</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">groupQuant &lt;-<span class="st"> </span><span class="kw">quantification</span>(quant.skyline, <span class="dt">type=</span><span class="st">&#39;Group&#39;</span>)
<span class="kw">head</span>(groupQuant)</code></pre>
<pre><code>##                 Protein Condition1 Condition2 Condition3 Condition4
## 1  sp|D6VTK4|STE2_YEAST   26.60824   26.79392   26.53057   26.60602
## 2  sp|O13297|CET1_YEAST   24.71754   24.57784   24.62606   24.64876
## 3  sp|O13329|FOB1_YEAST   23.47021   23.43389   23.73769   23.16636
## 4  sp|O13539|THP2_YEAST   27.38549   25.90566   25.91828   25.91791
## 5 sp|O13547|CCW14_YEAST   27.11584   26.91263   26.75494   26.98071
## 6 sp|O13563|RPN13_YEAST   26.17001   26.00997   26.11441   26.05425</code></pre>
<hr />
</div>
<div id="msstats.log-and-sessioninfo.txt" class="section level4">
<h4><span class="header-section-number">2.3.1.6</span> msstats.log and sessionInfo.txt</h4>
<p>These two files are important to keep the records of package versions and options in functions.</p>
<p><img src="img/logfileexample.png" style="width:90.0%" /></p>
<hr />
</div>
</div>
<div id="inference-and-future-design-of-experiment-with-skyline-output-1" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Inference and future design of experiment with Skyline output</h3>
<blockquote>
<p>Challenges</p>
<p>Load the processed data (output of dataProcess from section 2 of MaxQuant output and 1) find the differentially abundant comparisons using <code>groupComparison</code> with the same <code>comparison</code> matrix, 2) draw volcano plot with output of <code>groupComparison</code>, and 3) draw comparison plot with output of <code>groupComparison</code> with MaxQuant output. and Check the comparison plot for the protein, <code>P55249</code>.</p>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_MaxQuant/quant.maxquant.rda&#39;</span>)

test.maxquant &lt;-<span class="st"> </span><span class="kw">groupComparison</span>(<span class="dt">contrast.matrix=</span>comparison, <span class="dt">data=</span>quant.maxquant)
MaxQuant.result &lt;-<span class="st"> </span>test.maxquant<span class="op">$</span>ComparisonResult
<span class="kw">write.csv</span>(MaxQuant.result, <span class="dt">file=</span><span class="st">&#39;data/data_MaxQuant/testResult_ABRF_maxquant.csv&#39;</span>)

<span class="kw">groupComparisonPlots</span>(<span class="dt">data =</span> MaxQuant.result, 
                     <span class="dt">type =</span> <span class="st">&#39;VolcanoPlot&#39;</span>,
                     <span class="dt">address =</span> <span class="st">&#39;data/data_MaxQuant/testResult_ABRF_maxquant_&#39;</span>)

<span class="kw">groupComparisonPlots</span>(<span class="dt">data =</span> MaxQuant.result, 
                     <span class="dt">type =</span> <span class="st">&#39;ComparisonPlot&#39;</span>,
                     <span class="dt">which.Protein =</span> <span class="st">&#39;P55249&#39;</span>,
                     <span class="dt">address =</span> <span class="st">&#39;data/data_MaxQuant/testResult_ABRF_maxquant_&#39;</span>)</code></pre>
</details>
<hr />
</div>
<div id="inference-and-future-design-of-experiment-with-openms-output" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Inference and future design of experiment with OpenMS output</h3>
<blockquote>
<p>Challenges</p>
</blockquote>
<blockquote>
<p>Load the processed data (output of dataProcess from section 2 of OpenMS output and 1) find the differentially abundant comparisons using <code>groupComparison</code> with the same <code>comparison</code> matrix, 2) draw volcano plot with output of <code>groupComparison</code>, and 3) draw comparison plot with output of <code>groupComparison</code> with OpenMS output. and Check the comparison plot for the protein, <code>sp|P55249|ZRT4_YEAST</code>.</p>
</blockquote>
<details>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/data_OpenMS/quant.openms.rda&#39;</span>)

test.openms &lt;-<span class="st"> </span><span class="kw">groupComparison</span>(<span class="dt">contrast.matrix=</span>comparison, <span class="dt">data=</span>quant.openms)
OpenMS.result &lt;-<span class="st"> </span>test.openms<span class="op">$</span>ComparisonResult
<span class="kw">write.csv</span>(OpenMS.result, <span class="dt">file=</span><span class="st">&#39;data/data_OpenMS/testResult_ABRF_openms.csv&#39;</span>)

<span class="kw">groupComparisonPlots</span>(<span class="dt">data =</span> MaxQuant.result, 
                     <span class="dt">type =</span> <span class="st">&#39;VolcanoPlot&#39;</span>,
                     <span class="dt">address =</span> <span class="st">&#39;data/data_OpenMS/testResult_ABRF_openms_&#39;</span>)

<span class="kw">groupComparisonPlots</span>(<span class="dt">data =</span> MaxQuant.result, 
                     <span class="dt">type =</span> <span class="st">&#39;ComparisonPlot&#39;</span>,
                     <span class="dt">which.Protein =</span> <span class="st">&#39;sp|P55249|ZRT4_YEAST&#39;</span>,
                     <span class="dt">address =</span> <span class="st">&#39;data/data_OpenMS/testResult_ABRF_openms_&#39;</span>)</code></pre>
</details>
<p>Here is the experimental design for ABRF 2015 study.
<img src="img/Protein_sample_information.png" alt="Summary of the ABRF 2015 study design, Choi, et al. J Proteome Res. 2017" style="width:70.0%" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-6-introductory-statistics-with-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-9-msstatstmt.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/asms2019-day2-sec8.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
